
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Brotherc">
    <title>归档 - Brotherc</title>
    <meta name="author" content="Brotherc">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Brotherc">
<meta property="og:url" content="http://yoursite.com/archives/index.html">
<meta property="og:site_name" content="Brotherc">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brotherc">
    
    
        
    
    
        <meta property="og:image" content="http://yoursite.com/assets/images/head.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Brotherc</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="/assets/images/head.jpg" alt="作者的图片">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/head.jpg" alt="作者的图片">
                </a>
                <h4 class="sidebar-profile-name">Brotherc</h4>
                
                    <h5 class="sidebar-profile-bio"><p>java development</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="首页">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="分类">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="标签">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link open-algolia-search" href="/all-archives" title="归档">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="关于">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/Brotherc" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/08/29/云析学院-Google平滑限流方案-Guava/">
                            Google平滑限流方案-Guava
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-08-29T23:20:38+08:00">
	
		    8月 29, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <ul>
<li><p><strong>大厂面试题，说说你知道的限流方案</strong></p>
</li>
<li><p><strong>限流场景</strong><br>12306<br>双十一（11.11零点，由于各种商家的促销活动(前XX名免单)，支付宝进入排队支付状态）<br>外卖业务</p>
</li>
<li><p><strong>常见的限流方案</strong></p>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
</li>
</ul>
<h2 id="Guava是什么"><a href="#Guava是什么" class="headerlink" title="Guava是什么"></a>Guava是什么</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Guava限流核心算法"><a href="#Guava限流核心算法" class="headerlink" title="Guava限流核心算法"></a>Guava限流核心算法</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/13.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/13.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/14.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/14.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/15.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/15.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/16.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/16.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Guava限流实战"><a href="#Guava限流实战" class="headerlink" title="Guava限流实战"></a>Guava限流实战</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/20.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/20.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>平滑突发限流</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 平滑突发限流(SmoothBursty)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmoothBurstyRateLimitTest01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//每秒允许5个请求，表示桶容量为5且每秒新增5个令牌，即每隔0.2秒新增一个令牌</span></span><br><span class="line">        RateLimiter limiter = RateLimiter.create(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//如果当前桶中有足够令牌则成功（返回值为0）返回获取token的耗时，以秒为单位</span></span><br><span class="line">        <span class="comment">//将突发请求速率平均为了固定请求速率，固定频率=0.2s/个</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/17.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/17.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 平滑突发限流(SmoothBursty) 使用场景：对冷数据的预热处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmoothBurstyRateLimitTest02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//每秒允许5个请求，表示桶容量为5且每秒新增5个令牌，即每隔0.2秒新增一个令牌</span></span><br><span class="line">        RateLimiter limiter = RateLimiter.create(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//一次性消费5个令牌，模拟预热的场景（初始化redis缓存）</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">5</span>));</span><br><span class="line">        <span class="comment">//limiter.acquire(1)将等待差不多1秒桶中才能有令牌</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//固定速率</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//固定速率</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//固定速率</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/18.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/18.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 平滑突发限流(SmoothBursty) 使用场景：对冷数据的预热处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmoothBurstyRateLimitTest03</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//每秒允许5个请求，表示桶容量为5且每秒新增5个令牌，即每隔0.2毫秒新增一个令牌</span></span><br><span class="line">        RateLimiter limiter = RateLimiter.create(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//第一秒突发了10个请求</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">10</span>));</span><br><span class="line">        <span class="comment">//limiter.acquire(1)将等待差不多2秒桶中才能有令牌</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//固定速率</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//固定速率</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//固定速率</span></span><br><span class="line">        System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/19.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/19.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>平滑预热限流</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 平滑预热限流(SmoothWarmingUp)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmoothWarmingUp</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//permitsPerSecond:每秒新增的令牌数  warmupPeriod:从冷启动速率过渡到平均速率的时间间隔</span></span><br><span class="line">        <span class="comment">//系统冷启动后慢慢的趋于平均固定速率（即刚开始速率慢一些，然后慢慢趋于我们设置的固定速率）</span></span><br><span class="line">        RateLimiter limiter = RateLimiter.create(<span class="number">10</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>;i++) &#123;</span><br><span class="line">            <span class="comment">//获取一个令牌</span></span><br><span class="line">            System.out.println(limiter.acquire(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/21.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/21.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>Guava用于秒杀场景</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> Guava秒杀场景：Guava使得商品被均匀的被秒杀，效果较好，未秒到商品的用户引流至推荐页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuavaSecKill</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//限流，每秒允许10个请求进入秒杀 QPS=10 令牌生成速度=100ms/个</span></span><br><span class="line">        RateLimiter limiter = RateLimiter.create(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 开线程池</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//100个线程同时抢购</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">            executorService.submit(() -&gt; &#123;</span><br><span class="line">                <span class="comment">//每个秒杀请求如果在50ms（0.05s）以内得到令牌，就算是秒杀成功，否则就返回秒杀失败</span></span><br><span class="line">                <span class="keyword">if</span> (limiter.tryAcquire(<span class="number">50</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (CountUtils.TOTAL_COUNT.get() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">//库存减1</span></span><br><span class="line">                        CountUtils.decrease();</span><br><span class="line">                        System.out.println(<span class="string">"恭喜您，秒杀成功！！！"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">"秒杀失败，商品已售完"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"秒杀失败，请继续努力~"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//给limiter 0.01s的时间生成新的令牌生成</span></span><br><span class="line">            Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/22.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/22.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/23.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/23.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/24.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/24.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/25.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/25.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/26.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/26.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/Google平滑限流方案-Guava/27.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/Google平滑限流方案-Guava/27.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>参考：<br><a href="https://github.com/online-demo/yunxi-guava/tree/master/src/main/java/com/yunxi/demo/guava" target="_blank" rel="noopener">https://github.com/online-demo/yunxi-guava/tree/master/src/main/java/com/yunxi/demo/guava</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/08/29/云析学院-Google平滑限流方案-Guava/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/08/23/数据库并发压力大-教你大厂如何玩优化/">
                            数据库并发压力大-教你大厂如何玩优化
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-08-23T23:22:36+08:00">
	
		    8月 23, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/13.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/13.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/14.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/14.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/15.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/15.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/16.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/16.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/17.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/17.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/数据库并发压力大-教你大厂如何玩优化/18.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/数据库并发压力大-教你大厂如何玩优化/18.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>datasource.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans-4.1.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx-4.1.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">	   http://www.springframework.org/schema/context/spring-context-4.1.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.study"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"abstractDataSource"</span> <span class="attr">abstract</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 写库 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceWrite"</span> <span class="attr">parent</span>=<span class="string">"abstractDataSource"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 基本属性 url、user、password --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://allen.aliyun.com:3306/mybatis?serverTimezone=UTC&amp;amp;characterEncoding=utf-8&amp;amp;autoReconnect=true&amp;amp;allowMultiQueries=true"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root@123456"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 读库 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceRead"</span> <span class="attr">parent</span>=<span class="string">"abstractDataSource"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 基本属性 url、user、password --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://allen.aliyun.com:3307/mybatis?serverTimezone=UTC&amp;amp;characterEncoding=utf-8&amp;amp;autoReconnect=true&amp;amp;allowMultiQueries=true"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root@123456"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 动态数据源 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.study.rwdb.DynamicDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"writeDataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourceWrite"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"readDataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourceRead"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 动态事务管理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"com.study.rwdb.DynamicDataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置sqlSessionFactory --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 实例化sqlSessionFactory时需要使用上述配置好的数据源以及SQL映射文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--configLocation属性指定mybatis的核心配置文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis-config.xml"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 所有配置的mapper文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:com/study/mapper/*.xml"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 所有的实体 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.study.entity"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"plugins"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.study.rwdb.DynamicPlugin"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置扫描器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 扫描包以及它的子包下的所有映射接口类 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.study.mapper"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>DynamicDataSourceGlobal.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 读写操作对应数据源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> DynamicDataSourceGlobal &#123;</span><br><span class="line">    READ, WRITE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DynamicDataSourceHolder.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用ThreadLocal技术来记录当前线程中的数据源的key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSourceHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用ThreadLocal记录当前线程的数据源key</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;DynamicDataSourceGlobal&gt; holder = <span class="keyword">new</span> ThreadLocal&lt;DynamicDataSourceGlobal&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DynamicDataSourceHolder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置数据源</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putDataSource</span><span class="params">(DynamicDataSourceGlobal dataSource)</span></span>&#123;</span><br><span class="line">        holder.set(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DynamicDataSourceGlobal <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> holder.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清理数据源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clearDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        holder.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DynamicDataSource.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取数据源，用于动态切换数据源</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * 实现Spring提供的AbstractRoutingDataSource，只需要实现determineCurrentLookupKey方法即可，</span></span><br><span class="line"><span class="comment"> * 由于DynamicDataSource是单例的，线程不安全的，所以采用ThreadLocal保证线程安全，</span></span><br><span class="line"><span class="comment"> * 由DynamicDataSourceHolder完成。</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 写数据源 3306</span></span><br><span class="line">    <span class="keyword">private</span> Object writeDataSource;</span><br><span class="line">    <span class="comment">// 读数据源 3307</span></span><br><span class="line">    <span class="keyword">private</span> Object readDataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.writeDataSource == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Property 'writeDataSource' is required"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 覆盖AbstractRoutingDataSource中的默认数据源为 write</span></span><br><span class="line">        setDefaultTargetDataSource(writeDataSource);</span><br><span class="line">        Map&lt;Object, Object&gt; targetDataSources = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        targetDataSources.put(DynamicDataSourceGlobal.WRITE.name(), writeDataSource);</span><br><span class="line">        <span class="keyword">if</span> (readDataSource != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果读数据源不为空就压入map</span></span><br><span class="line">            targetDataSources.put(DynamicDataSourceGlobal.READ.name(), readDataSource);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置目标数据源为map中压入的数据源</span></span><br><span class="line">        setTargetDataSources(targetDataSources);</span><br><span class="line">        <span class="keyword">super</span>.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取与数据源相关的key 此key是Map&lt;String,DataSource&gt; resolvedDataSources 中与数据源绑定的key值</span></span><br><span class="line"><span class="comment">     * 在通过determineTargetDataSource获取目标数据源时使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用DynamicDataSourceHolder保证线程安全，并且得到当前线程中的数据源key</span></span><br><span class="line">        DynamicDataSourceGlobal dynamicDataSourceGlobal = DynamicDataSourceHolder.getDataSource();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dynamicDataSourceGlobal == <span class="keyword">null</span> || dynamicDataSourceGlobal == DynamicDataSourceGlobal.WRITE) &#123;</span><br><span class="line">            <span class="keyword">return</span> DynamicDataSourceGlobal.WRITE.name();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> DynamicDataSourceGlobal.READ.name();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get and set method</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWriteDataSource</span><span class="params">(Object writeDataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.writeDataSource = writeDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getWriteDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> writeDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getReadDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadDataSource</span><span class="params">(Object readDataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.readDataSource = readDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DynamicPlugin.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.Executor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.keygen.SelectKeyGenerator;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.BoundSql;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.SqlCommandType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.RowBounds;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronizationManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mybatis插件，通过拦截Executor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">	<span class="meta">@Signature</span>(type = Executor.class, method = <span class="string">"update"</span>, args = &#123; MappedStatement.class, Object.class &#125;),</span><br><span class="line">	<span class="meta">@Signature</span>(type = Executor.class, method = <span class="string">"query"</span>, args = &#123; MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class &#125;) </span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicPlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Logger log = LoggerFactory.getLogger(DynamicPlugin.class);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGEX = <span class="string">".*insert$|.*delete$|.*update$"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, DynamicDataSourceGlobal&gt; cacheMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		<span class="comment">// 如果拥有事务上下文，则将连接绑定到事务上下文中</span></span><br><span class="line">		<span class="keyword">boolean</span> synchronizationActive = TransactionSynchronizationManager.isSynchronizationActive();</span><br><span class="line">		<span class="keyword">if</span> (!synchronizationActive) &#123;</span><br><span class="line">			Object[] objects = invocation.getArgs();</span><br><span class="line">			MappedStatement ms = (MappedStatement) objects[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">			DynamicDataSourceGlobal dynamicDataSourceGlobal = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> ((dynamicDataSourceGlobal = cacheMap.get(ms.getId())) == <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="comment">// 读方法</span></span><br><span class="line">				<span class="keyword">if</span> (ms.getSqlCommandType().equals(SqlCommandType.SELECT)) &#123; <span class="comment">// select * from user;    update insert</span></span><br><span class="line">					<span class="comment">// !selectKey 为自增id查询主键(SELECT LAST_INSERT_ID() )方法，使用主库</span></span><br><span class="line">					<span class="keyword">if</span> (ms.getId().contains(SelectKeyGenerator.SELECT_KEY_SUFFIX)) &#123;</span><br><span class="line">						dynamicDataSourceGlobal = DynamicDataSourceGlobal.WRITE;</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						BoundSql boundSql = ms.getSqlSource().getBoundSql(objects[<span class="number">1</span>]);</span><br><span class="line">						</span><br><span class="line">						String sql = boundSql.getSql().toLowerCase(Locale.CHINA).replaceAll(<span class="string">"[\\t\\n\\r]"</span>, <span class="string">" "</span>);</span><br><span class="line">						<span class="keyword">if</span> (sql.matches(REGEX)) &#123;</span><br><span class="line">							dynamicDataSourceGlobal = DynamicDataSourceGlobal.WRITE;</span><br><span class="line">						&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">							dynamicDataSourceGlobal = DynamicDataSourceGlobal.READ;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">// 写方法</span></span><br><span class="line">					dynamicDataSourceGlobal = DynamicDataSourceGlobal.WRITE;</span><br><span class="line">				&#125;</span><br><span class="line">				System.out.println(<span class="string">"设置方法[&#123;"</span>+ms.getId()+<span class="string">"&#125;] use [&#123;"</span>+dynamicDataSourceGlobal.name()+<span class="string">"&#125;] Strategy, SqlCommandType [&#123;"</span>+ms.getSqlCommandType().name()+<span class="string">"&#125;].."</span>);</span><br><span class="line">				log.warn(<span class="string">"设置方法[&#123;&#125;] use [&#123;&#125;] Strategy, SqlCommandType [&#123;&#125;].."</span>, ms.getId(), dynamicDataSourceGlobal.name(), ms.getSqlCommandType().name());</span><br><span class="line">				<span class="comment">// 把id(方法名)和数据源存入map，下次命中后就直接执行                                                                                                  </span></span><br><span class="line">				cacheMap.put(ms.getId(), dynamicDataSourceGlobal);</span><br><span class="line">			&#125;</span><br><span class="line">			DynamicDataSourceHolder.putDataSource(dynamicDataSourceGlobal);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> invocation.proceed();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (target <span class="keyword">instanceof</span> Executor) &#123;</span><br><span class="line">			<span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> target;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DynamicDataSourceTransactionManager.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义事务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSourceTransactionManager</span> <span class="keyword">extends</span> <span class="title">DataSourceTransactionManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只读事务到读库，读写事务到写库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> transaction</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> definition</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doBegin</span><span class="params">(Object transaction, TransactionDefinition definition)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置数据源</span></span><br><span class="line">        <span class="keyword">boolean</span> readOnly = definition.isReadOnly();</span><br><span class="line">        <span class="keyword">if</span> (readOnly) &#123;</span><br><span class="line">            DynamicDataSourceHolder.putDataSource(DynamicDataSourceGlobal.READ);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            DynamicDataSourceHolder.putDataSource(DynamicDataSourceGlobal.WRITE);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.doBegin(transaction, definition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清理本地线程的数据源</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> transaction</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doCleanupAfterCompletion</span><span class="params">(Object transaction)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.doCleanupAfterCompletion(transaction);</span><br><span class="line">        DynamicDataSourceHolder.clearDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/08/23/数据库并发压力大-教你大厂如何玩优化/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/08/19/JAVA加解密/">
                            JAVA加解密
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-08-19T12:27:02+08:00">
	
		    8月 19, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Java实现Base64加密"><a href="#Java实现Base64加密" class="headerlink" title="Java实现Base64加密"></a>Java实现Base64加密</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/13.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/13.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/14.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/14.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/15.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/15.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/16.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/16.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Decoder;</span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Base64Test</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"base64 test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkBase64();</span><br><span class="line">		</span><br><span class="line">		commonsCodesBase64();</span><br><span class="line"></span><br><span class="line">		bouncyCastleBase64();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkBase64</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			BASE64Encoder encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line">			String encode = encoder.encode(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"encode:"</span> + encode);</span><br><span class="line">			</span><br><span class="line">			BASE64Decoder decoder = <span class="keyword">new</span> BASE64Decoder();</span><br><span class="line">			System.out.println(<span class="string">"decode:"</span> + <span class="keyword">new</span> String(decoder.decodeBuffer(encode)));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用Apache的common codes实现</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commonsCodesBase64</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">byte</span>[] encodeBytes = Base64.encodeBase64(src.getBytes());</span><br><span class="line">		System.out.println(<span class="string">"common codes encode:"</span> + <span class="keyword">new</span> String(encodeBytes));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">byte</span>[] dencodeBytes = Base64.decodeBase64(encodeBytes);</span><br><span class="line">		System.out.println(<span class="string">"common codes decode:"</span> + <span class="keyword">new</span> String(dencodeBytes));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用bouncy castle实现</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bouncyCastleBase64</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">byte</span>[] encodeBytes = org.bouncycastle.util.encoders.Base64.encode(src.getBytes());</span><br><span class="line">		System.out.println(<span class="string">"bouncy castle encode:"</span> + <span class="keyword">new</span> String(encodeBytes));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">byte</span>[] dencodeBytes = org.bouncycastle.util.encoders.Base64.decode(encodeBytes);</span><br><span class="line">		System.out.println(<span class="string">"bouncy castle decode:"</span> + <span class="keyword">new</span> String(dencodeBytes));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/17.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/17.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/18.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/18.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Java实现消息摘要算法加密"><a href="#Java实现消息摘要算法加密" class="headerlink" title="Java实现消息摘要算法加密"></a>Java实现消息摘要算法加密</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/28.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/28.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/29.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/29.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/30.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/30.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.MD4Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.MD5Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5Test</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"md5 test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkMD5();</span><br><span class="line">		jdkMD2();</span><br><span class="line">		</span><br><span class="line">		bcMD4();</span><br><span class="line">		bcMD5();</span><br><span class="line">		</span><br><span class="line">		bc2jdkMD4();</span><br><span class="line">		</span><br><span class="line">		ccMD5();</span><br><span class="line">		ccMD2();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:MD5</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkMD5</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">			<span class="keyword">byte</span>[] md5Bytes = md.digest(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"JDK MD5:"</span> + Hex.encodeHexString(md5Bytes));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:MD2</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkMD2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			MessageDigest md = MessageDigest.getInstance(<span class="string">"MD2"</span>);</span><br><span class="line">			<span class="keyword">byte</span>[] md2Bytes = md.digest(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"JDK MD2:"</span> + Hex.encodeHexString(md2Bytes));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:MD5</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcMD5</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		MD5Digest digest = <span class="keyword">new</span> MD5Digest();</span><br><span class="line">		digest.update(src.getBytes(),<span class="number">0</span>,src.getBytes().length);</span><br><span class="line">		<span class="keyword">byte</span>[] md5Bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[digest.getDigestSize()];</span><br><span class="line">		digest.doFinal(md5Bytes, <span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">"bouncy castle MD5:"</span> + org.bouncycastle.util.encoders.Hex.toHexString(md5Bytes));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用bouncy castle实现:MD4</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcMD4</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		MD4Digest digest = <span class="keyword">new</span> MD4Digest();</span><br><span class="line">		digest.update(src.getBytes(),<span class="number">0</span>,src.getBytes().length);</span><br><span class="line">		<span class="keyword">byte</span>[] md4Bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[digest.getDigestSize()];</span><br><span class="line">		digest.doFinal(md4Bytes, <span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">"bouncy castle MD4:"</span> + org.bouncycastle.util.encoders.Hex.toHexString(md4Bytes));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle与jdk结合实现:MD4</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bc2jdkMD4</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			MessageDigest md = MessageDigest.getInstance(<span class="string">"MD4"</span>);</span><br><span class="line">			<span class="keyword">byte</span>[] md4Bytes = md.digest(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc and JDK MD4:"</span> + Hex.encodeHexString(md4Bytes));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用common codes实现实现:MD5</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ccMD5</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"common codes MD5:"</span> + DigestUtils.md5Hex(src.getBytes()));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用common codes实现实现:MD2</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ccMD2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"common codes MD2:"</span> + DigestUtils.md2Hex(src.getBytes()));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/31.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/31.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/32.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/32.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.SHA1Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.SHA224Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SHATest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"sha test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkSHA1();</span><br><span class="line">		bcSHA1();</span><br><span class="line">		bcSHA224();</span><br><span class="line">		bcSHA224b();</span><br><span class="line">		generateSha256();</span><br><span class="line">		ccSHA1();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:SHA1</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkSHA1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			MessageDigest md = MessageDigest.getInstance(<span class="string">"SHA"</span>);</span><br><span class="line">			md.update(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk sha-1:"</span> + Hex.encodeHexString(md.digest()));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:SHA1 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcSHA1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		Digest digest = <span class="keyword">new</span> SHA1Digest();</span><br><span class="line">		digest.update(src.getBytes(), <span class="number">0</span>, src.getBytes().length );</span><br><span class="line">		<span class="keyword">byte</span>[] sha1Bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[digest.getDigestSize()];</span><br><span class="line">		digest.doFinal(sha1Bytes, <span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">"bc sha-1:"</span> + org.bouncycastle.util.encoders.Hex.toHexString(sha1Bytes));		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用bouncy castle实现:SHA224 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcSHA224</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		Digest digest = <span class="keyword">new</span> SHA224Digest();</span><br><span class="line">		digest.update(src.getBytes(), <span class="number">0</span>, src.getBytes().length );</span><br><span class="line">		<span class="keyword">byte</span>[] sha224Bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[digest.getDigestSize()];</span><br><span class="line">		digest.doFinal(sha224Bytes, <span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">"bc sha-224:"</span> + org.bouncycastle.util.encoders.Hex.toHexString(sha224Bytes));		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle与jdk结合实现:SHA224 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcSHA224b</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			MessageDigest md = MessageDigest.getInstance(<span class="string">"SHA224"</span>);</span><br><span class="line">			md.update(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc and JDK sha-224:"</span> + Hex.encodeHexString(md.digest()));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateSha256</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		MessageDigest md = MessageDigest.getInstance(<span class="string">"SHA-256"</span>);</span><br><span class="line"></span><br><span class="line">        md.update(src.getBytes(<span class="string">"UTF-8"</span>)); <span class="comment">// Change this to "UTF-16" if needed</span></span><br><span class="line">        <span class="keyword">byte</span>[] digest = md.digest();</span><br><span class="line">        BigInteger bigInt = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, digest);</span><br><span class="line">        System.out.println(<span class="string">"Sha256 hash: "</span> + bigInt.toString(<span class="number">16</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用common codes实现实现:SHA1</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ccSHA1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"common codes SHA1 - 1 :"</span> + DigestUtils.sha1Hex(src.getBytes()));</span><br><span class="line">		System.out.println(<span class="string">"common codes SHA1 - 2 :"</span> + DigestUtils.sha1Hex(src));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/33.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/33.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/34.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/34.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/35.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/35.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/36.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/36.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.MD5Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.macs.HMac;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.params.KeyParameter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HMACTest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"hmac test"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkHmacMD5();</span><br><span class="line">		bcHmacMD5();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkHmacMD5</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 初始化KeyGenerator</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"HmacMD5"</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line"><span class="comment">//			byte[] key = secretKey.getEncoded();</span></span><br><span class="line">			<span class="keyword">byte</span>[] key = Hex.decodeHex(<span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span> &#125;);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 还原密钥</span></span><br><span class="line">			SecretKey restoreSecretKey = <span class="keyword">new</span> SecretKeySpec(key, <span class="string">"HmacMD5"</span>);</span><br><span class="line">			<span class="comment">// 实例化MAC</span></span><br><span class="line">			Mac mac = Mac.getInstance(restoreSecretKey.getAlgorithm());</span><br><span class="line">			<span class="comment">// 初始化MAC</span></span><br><span class="line">			mac.init(restoreSecretKey);</span><br><span class="line">			<span class="comment">// 执行摘要</span></span><br><span class="line">			<span class="keyword">byte</span>[] hmacMD5Bytes = mac.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk hmacMD5:"</span> + Hex.encodeHexString(hmacMD5Bytes));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcHmacMD5</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HMac hmac = <span class="keyword">new</span> HMac(<span class="keyword">new</span> MD5Digest());</span><br><span class="line">		<span class="comment">// 必须是16进制的字符，长度必须是2的倍数</span></span><br><span class="line">		hmac.init(<span class="keyword">new</span> KeyParameter(org.bouncycastle.util.encoders.Hex.decode(<span class="string">"123456789abcde"</span>)));</span><br><span class="line">		hmac.update(src.getBytes(), <span class="number">0</span>, src.getBytes().length);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 执行摘要</span></span><br><span class="line">		<span class="keyword">byte</span>[] hmacMD5Bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[hmac.getMacSize()];</span><br><span class="line">		hmac.doFinal(hmacMD5Bytes, <span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">"bc hmacMD5:"</span> + org.bouncycastle.util.encoders.Hex.toHexString(hmacMD5Bytes));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/37.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/37.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/38.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/38.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Java实现对称加密"><a href="#Java实现对称加密" class="headerlink" title="Java实现对称加密"></a>Java实现对称加密</h2><ul>
<li>软件、硬件</li>
<li>加密密钥=解密密钥</li>
<li>初等、DES(3DES)、AES、PBE、IDEA</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/19.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/19.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DESTest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"des test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkDES();</span><br><span class="line">		bcDES();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkDES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"DES"</span>);			</span><br><span class="line">			keyGenerator.init(<span class="number">56</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytesKey = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			DESKeySpec desKeySpec = <span class="keyword">new</span> DESKeySpec(bytesKey);</span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"DES"</span>);</span><br><span class="line">			Key convertSecretKey = factory.generateSecret(desKeySpec);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, convertSecretKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk des encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, convertSecretKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"jdk des decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcDES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"DES"</span>, <span class="string">"BC"</span>);</span><br><span class="line">			keyGenerator.getProvider();</span><br><span class="line">			keyGenerator.init(<span class="number">56</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytesKey = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			DESKeySpec desKeySpec = <span class="keyword">new</span> DESKeySpec(bytesKey);</span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"DES"</span>);</span><br><span class="line">			Key convertSecretKey = factory.generateSecret(desKeySpec);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, convertSecretKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc des encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, convertSecretKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"bc des decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/20.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/20.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/21.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/21.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/22.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/22.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/23.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/23.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/24.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/24.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/25.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/25.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESedeKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DES3Test</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"3des test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdk3DES();</span><br><span class="line">		bc3DES();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdk3DES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"DESede"</span>);	</span><br><span class="line">			<span class="comment">// 必须长度是：112或168</span></span><br><span class="line"><span class="comment">//			keyGenerator.init(168);</span></span><br><span class="line">			keyGenerator.init(<span class="keyword">new</span> SecureRandom());</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytesKey = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			DESedeKeySpec desKeySpec = <span class="keyword">new</span> DESedeKeySpec(bytesKey);</span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"DESede"</span>);</span><br><span class="line">			Key convertSecretKey = factory.generateSecret(desKeySpec);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DESede/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, convertSecretKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk 3des encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, convertSecretKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"jdk 3des decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bc3DES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"DESede"</span>, <span class="string">"BC"</span>);</span><br><span class="line">			keyGenerator.getProvider();</span><br><span class="line">			keyGenerator.init(<span class="number">168</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytesKey = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			DESedeKeySpec desKeySpec = <span class="keyword">new</span> DESedeKeySpec(bytesKey);</span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"DESede"</span>);</span><br><span class="line">			Key convertSecretKey = factory.generateSecret(desKeySpec);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DESede/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, convertSecretKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc 3des encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, convertSecretKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"bc 3des decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>AES是目前使用最多的对称加密算法</li>
<li>AES的优势之一是至今尚未被破解</li>
<li>AES通常用于移动通信系统加密以及基于SSH协议的软件(SSH Client、secureCRT)</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/26.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/26.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AESTest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"aes test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkAES();</span><br><span class="line">		bcAES();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkAES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"AES"</span>);			</span><br><span class="line">			keyGenerator.init(<span class="number">128</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] keyBytes = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			Key key = <span class="keyword">new</span> SecretKeySpec(keyBytes, <span class="string">"AES"</span>);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"AES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk aes encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"jdk aes decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcAES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"AES"</span>, <span class="string">"BC"</span>);	</span><br><span class="line">			keyGenerator.getProvider();</span><br><span class="line">			keyGenerator.init(<span class="number">128</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] keyBytes = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			Key key = <span class="keyword">new</span> SecretKeySpec(keyBytes, <span class="string">"AES"</span>);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"AES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc aes encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"bc aes decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/27.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/27.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/39.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/39.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/40.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/40.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/41.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/41.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/42.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/42.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/43.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/43.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEParameterSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PBETest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"pbe test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkPBE();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkPBE</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 初始化盐</span></span><br><span class="line">			SecureRandom random = <span class="keyword">new</span> SecureRandom();</span><br><span class="line">			<span class="keyword">byte</span>[] salt = random.generateSeed(<span class="number">8</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 口令与密钥</span></span><br><span class="line">			String password = <span class="string">"timliu"</span>;</span><br><span class="line">			PBEKeySpec pbeKeySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray()); </span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"PBEWITHMD5andDES"</span>);</span><br><span class="line">			Key key = factory.generateSecret(pbeKeySpec);</span><br><span class="line">			</span><br><span class="line">									</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			PBEParameterSpec pbeParameterSpac = <span class="keyword">new</span> PBEParameterSpec(salt, <span class="number">100</span>);</span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"PBEWITHMD5andDES"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, key, pbeParameterSpac);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk pbe encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key, pbeParameterSpac);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"jdk pbe decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Java实现非对称加密"><a href="#Java实现非对称加密" class="headerlink" title="Java实现非对称加密"></a>Java实现非对称加密</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/44.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/44.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/45.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/45.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/46.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/46.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/47.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/47.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/48.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/48.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/49.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/49.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/50.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/50.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/51.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/51.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/52.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/52.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/53.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/53.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/54.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/54.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/55.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/55.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/56.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/56.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/57.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/57.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/58.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/58.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/59.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/59.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.KeyFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyAgreement;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.interfaces.DHPublicKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DHParameterSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.utils.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DHTest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"dh test"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkDH();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// jdk实现：</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkDH</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;		</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 1.初始化发送方密钥</span></span><br><span class="line">			KeyPairGenerator senderKeyPairGenerator = KeyPairGenerator.getInstance(<span class="string">"DH"</span>);</span><br><span class="line">			senderKeyPairGenerator.initialize(<span class="number">512</span>);</span><br><span class="line">			KeyPair senderKeyPair = senderKeyPairGenerator.generateKeyPair();</span><br><span class="line">			<span class="comment">// 发送方公钥，发送给接收方（网络、文件。。。）</span></span><br><span class="line">			<span class="keyword">byte</span>[] senderPublicKeyEnc = senderKeyPair.getPublic().getEncoded();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 2.初始化接收方密钥</span></span><br><span class="line">			KeyFactory receiverKeyFactory = KeyFactory.getInstance(<span class="string">"DH"</span>);</span><br><span class="line">			X509EncodedKeySpec x509EncodedKeySpec = <span class="keyword">new</span> X509EncodedKeySpec(senderPublicKeyEnc);</span><br><span class="line">			PublicKey receiverPublicKey = receiverKeyFactory.generatePublic(x509EncodedKeySpec);</span><br><span class="line">			DHParameterSpec dhParameterSpec = ((DHPublicKey) receiverPublicKey).getParams();</span><br><span class="line">			KeyPairGenerator receiverKeyPairGenerator = KeyPairGenerator.getInstance(<span class="string">"DH"</span>);</span><br><span class="line">			receiverKeyPairGenerator.initialize(dhParameterSpec);</span><br><span class="line">			KeyPair receiverKeypair = receiverKeyPairGenerator.generateKeyPair();</span><br><span class="line">			PrivateKey receiverPrivateKey = receiverKeypair.getPrivate();</span><br><span class="line">			<span class="keyword">byte</span>[] receiverPublicKeyEnc = receiverKeypair.getPublic().getEncoded();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 3.密钥构建</span></span><br><span class="line">			KeyAgreement receiverKeyAgreement = KeyAgreement.getInstance(<span class="string">"DH"</span>);</span><br><span class="line">			receiverKeyAgreement.init(receiverPrivateKey);</span><br><span class="line">			receiverKeyAgreement.doPhase(receiverPublicKey, <span class="keyword">true</span>);</span><br><span class="line">			SecretKey receiverDesKey = receiverKeyAgreement.generateSecret(<span class="string">"DES"</span>);</span><br><span class="line">			</span><br><span class="line">			KeyFactory senderKeyFactory = KeyFactory.getInstance(<span class="string">"DH"</span>);</span><br><span class="line">			x509EncodedKeySpec = <span class="keyword">new</span> X509EncodedKeySpec(receiverPublicKeyEnc);</span><br><span class="line">			PublicKey senderPublicKey = senderKeyFactory.generatePublic(x509EncodedKeySpec);</span><br><span class="line">			KeyAgreement senderKeyAgreement = KeyAgreement.getInstance(<span class="string">"DH"</span>);</span><br><span class="line">			senderKeyAgreement.init(senderKeyPair.getPrivate());</span><br><span class="line">			senderKeyAgreement.doPhase(senderPublicKey, <span class="keyword">true</span>);</span><br><span class="line">			SecretKey senderDesKey = senderKeyAgreement.generateSecret(<span class="string">"DES"</span>);</span><br><span class="line">			<span class="keyword">if</span>(Objects.equals(receiverDesKey, senderDesKey))</span><br><span class="line">			&#123;</span><br><span class="line">				System.out.println(<span class="string">"双方密钥相同。"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 4.加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DES"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, senderDesKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc dh encrypt:"</span> + Base64.encodeBase64String(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 5.解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, receiverDesKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"bc dh decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;			</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/60.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/60.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/61.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/61.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/62.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/62.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.KeyFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyAgreement;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.interfaces.DHPublicKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DHParameterSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.utils.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RSATest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"rsa test"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkRSA();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// jdk实现：</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkRSA</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;		</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 1.初始化发送方密钥</span></span><br><span class="line">			KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			keyPairGenerator.initialize(<span class="number">512</span>);</span><br><span class="line">			KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">			RSAPublicKey rsaPublicKey = (RSAPublicKey) keyPair.getPublic();</span><br><span class="line">			RSAPrivateKey rsaPrivateKey = (RSAPrivateKey) keyPair.getPrivate();</span><br><span class="line">			System.out.println(<span class="string">"Public Key:"</span> + Base64.encodeBase64String(rsaPublicKey.getEncoded()));</span><br><span class="line">			System.out.println(<span class="string">"Private Key:"</span> + Base64.encodeBase64String(rsaPrivateKey.getEncoded()));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 2.私钥加密、公钥解密 ---- 加密</span></span><br><span class="line">			PKCS8EncodedKeySpec pkcs8EncodedKeySpec = <span class="keyword">new</span> PKCS8EncodedKeySpec(rsaPrivateKey.getEncoded());</span><br><span class="line">			KeyFactory keyFactory = KeyFactory.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			PrivateKey privateKey = keyFactory.generatePrivate(pkcs8EncodedKeySpec);</span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, privateKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"私钥加密、公钥解密 ---- 加密:"</span> + Base64.encodeBase64String(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 3.私钥加密、公钥解密 ---- 解密</span></span><br><span class="line">			X509EncodedKeySpec x509EncodedKeySpec = <span class="keyword">new</span> X509EncodedKeySpec(rsaPublicKey.getEncoded());</span><br><span class="line">			keyFactory = KeyFactory.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			PublicKey publicKey = keyFactory.generatePublic(x509EncodedKeySpec);</span><br><span class="line">			cipher = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, publicKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"私钥加密、公钥解密 ---- 解密:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 4.公钥加密、私钥解密 ---- 加密</span></span><br><span class="line">			X509EncodedKeySpec x509EncodedKeySpec2 = <span class="keyword">new</span> X509EncodedKeySpec(rsaPublicKey.getEncoded());</span><br><span class="line">			KeyFactory keyFactory2 = KeyFactory.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			PublicKey publicKey2 = keyFactory2.generatePublic(x509EncodedKeySpec2);</span><br><span class="line">			Cipher cipher2 = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			cipher2.init(Cipher.ENCRYPT_MODE, publicKey2);</span><br><span class="line">			<span class="keyword">byte</span>[] result2 = cipher2.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"公钥加密、私钥解密 ---- 加密:"</span> + Base64.encodeBase64String(result2));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 5.私钥解密、公钥加密 ---- 解密</span></span><br><span class="line">			PKCS8EncodedKeySpec pkcs8EncodedKeySpec5 = <span class="keyword">new</span> PKCS8EncodedKeySpec(rsaPrivateKey.getEncoded());</span><br><span class="line">			KeyFactory keyFactory5 = KeyFactory.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			PrivateKey privateKey5 = keyFactory5.generatePrivate(pkcs8EncodedKeySpec5);</span><br><span class="line">			Cipher cipher5 = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">			cipher5.init(Cipher.DECRYPT_MODE, privateKey5);</span><br><span class="line">			<span class="keyword">byte</span>[] result5 = cipher5.doFinal(result2);</span><br><span class="line">			System.out.println(<span class="string">"公钥加密、私钥解密 ---- 解密:"</span> + <span class="keyword">new</span> String(result5));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/62.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/62.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/63.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/63.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/64.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/64.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/65.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/65.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/66.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/66.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/67.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/67.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>参考：<br><a href="https://github.com/Tim9Liu9/java_security" target="_blank" rel="noopener">https://github.com/Tim9Liu9/java_security</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/08/19/JAVA加解密/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/08/12/云析学院-原生JDK线程扩展-Guava/">
                            原生JDK线程扩展-Guava
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-08-12T23:03:41+08:00">
	
		    8月 12, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="JDK线程"><a href="#JDK线程" class="headerlink" title="JDK线程"></a>JDK线程</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>针对以上串行场景，有什么优化方案</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>谈谈你对Java线程池的理解</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>以上方式就是最优解吗？</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/13.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/13.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/14.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/14.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>95线  95%请求  300ms</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/15.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/15.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/16.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/16.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/17.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/17.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/18.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/18.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Guava对JDK扩展"><a href="#Guava对JDK扩展" class="headerlink" title="Guava对JDK扩展"></a>Guava对JDK扩展</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/19.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/19.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Guava实战"><a href="#Guava实战" class="headerlink" title="Guava实战"></a>Guava实战</h2><h5 id="模拟外部服务"><a href="#模拟外部服务" class="headerlink" title="模拟外部服务"></a>模拟外部服务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 模拟一个耗时的服务 如：RPC或者HTTP请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OuterService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">userService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"用户服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时1000ms的用户服务</span></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"用户服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设用户服务返回值=1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">orderService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"订单服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时2000ms的订单服务</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"订单服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设订单服务返回值=3</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">itemService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"商品服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时3000ms的商品服务</span></span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            <span class="comment">//模拟调用超时或者服务异常</span></span><br><span class="line">            <span class="comment">// throw new RuntimeException("Oh My God, OrderService Exception!!!");</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"商品服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设商品服务返回值=5</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 地址服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">addressService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"地址服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时5000ms的地址服务</span></span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"地址服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设地址服务返回值=7</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="单线程演示"><a href="#单线程演示" class="headerlink" title="单线程演示"></a>单线程演示</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 单线程操作演示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OuterService outerService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试代码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/single"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//开始调用的时间</span></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//同步调用用户服务</span></span><br><span class="line">        <span class="keyword">long</span> userServiceResult = outerService.userService();</span><br><span class="line">        <span class="comment">//同步调用订单服务</span></span><br><span class="line">        <span class="keyword">long</span> orderServiceResult = outerService.orderService();</span><br><span class="line">        <span class="comment">//同步调用商品服务</span></span><br><span class="line">        <span class="keyword">long</span> itemServiceResult = outerService.itemService();</span><br><span class="line">        <span class="comment">//结束调用的时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        String time = <span class="string">"总调用时间是："</span> + (end - start) + <span class="string">"毫秒"</span>;</span><br><span class="line">        <span class="comment">//计算结果</span></span><br><span class="line">        <span class="keyword">long</span> result = userServiceResult + orderServiceResult + itemServiceResult;</span><br><span class="line">        <span class="comment">//为什么要初始化4个容量的Map</span></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        resultMap.put(<span class="string">"time"</span>, time);</span><br><span class="line">        resultMap.put(<span class="string">"result"</span>, result);</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="JDK多线程演示"><a href="#JDK多线程演示" class="headerlink" title="JDK多线程演示"></a>JDK多线程演示</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: JDK多线程操作演示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkThreadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OuterService outerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/jdk"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 固定大小的线程池 核心线程数和最大线程数=10</span></span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">        Long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 异步调用用户服务</span></span><br><span class="line">        Future&lt;Long&gt; userServiceFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.userService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 异步调用订单服务</span></span><br><span class="line">        Future&lt;Long&gt; orderServiceFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.orderService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 异步调用商品服务</span></span><br><span class="line">        Future&lt;Long&gt; itemServiceFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.itemService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 阻塞 等待执行结果</span></span><br><span class="line">        <span class="keyword">long</span> userServiceResult = userServiceFuture.get();</span><br><span class="line">        <span class="keyword">long</span> orderServiceResult = orderServiceFuture.get();</span><br><span class="line">        <span class="keyword">long</span> itemServiceResult = itemServiceFuture.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//结束调用的时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//计算结果</span></span><br><span class="line">        <span class="keyword">long</span> result = userServiceResult + orderServiceResult + itemServiceResult;</span><br><span class="line">        String time = <span class="string">"总调用时间是："</span> + (end - start) + <span class="string">"毫秒"</span>;</span><br><span class="line">        <span class="comment">//为什么要初始化4个容量的Map</span></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        resultMap.put(<span class="string">"time"</span>, time);</span><br><span class="line">        resultMap.put(<span class="string">"result"</span>, result);</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Guava特性演示"><a href="#Guava特性演示" class="headerlink" title="Guava特性演示"></a>Guava特性演示</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.ListeningExecutorService;</span><br><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.MoreExecutors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 公用的线程池</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListeningExecutors</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListeningExecutorService <span class="title">createListeningExecutorService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建线程池</span></span><br><span class="line">        <span class="keyword">return</span> MoreExecutors.listeningDecorator(Executors.newFixedThreadPool(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.FutureCallback;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ListenableFuture回调任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureCallBackTask</span> <span class="keyword">implements</span> <span class="title">FutureCallback</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功的回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Object result)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//执行回调函数</span></span><br><span class="line">        System.out.println(<span class="string">"进入正确的回调函数"</span>);</span><br><span class="line">        <span class="comment">//得到任务执行的结果</span></span><br><span class="line">        System.out.printf(<span class="string">"任务执行的结果是：%s%n"</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败的回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> thrown</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable thrown)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"进入错误的回调函数"</span>);</span><br><span class="line">        System.out.printf(<span class="string">"系统出错了，错误原因是：%s%n"</span>, thrown.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Guava 线程简单测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuavaThreadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ListeningExecutorService listeningExecutorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/guava"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">        Long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 一个耗时的任务</span></span><br><span class="line">        ListenableFuture&lt;Boolean&gt; listenableFuture = listeningExecutorService.submit(() -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 注册回调事件</span></span><br><span class="line">        Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallBackTask(), listeningExecutorService);</span><br><span class="line">        <span class="comment">// 记录结束时间</span></span><br><span class="line">        Long end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 执行时间</span></span><br><span class="line">        System.out.println(<span class="string">"execute()方法执行结束了，耗时="</span> + (end - start) + <span class="string">"毫秒"</span>);</span><br><span class="line">        System.out.println(<span class="string">"-----------------------华丽的分割线-----------------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 高级特性介绍</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * transform：对于ListenableFuture的返回值进行转换。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * allAsList：对多个ListenableFuture的合并，返回一个当所有Future成功时返回多个Future返回值组成的List对象。</span></span><br><span class="line"><span class="comment"> * 注：当其中一个Future失败或者取消的时候，将会进入失败或者取消。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * successfulAsList：和allAsList相似，唯一差别是对于失败或取消的Future返回值用null代替。不会进入失败或者取消流程。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * immediateFuture/immediateCancelledFuture： 立即返回一个待返回值的ListenableFuture。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * makeChecked: 将ListenableFuture 转换成CheckedFuture。CheckedFuture 是一个ListenableFuture 。</span></span><br><span class="line"><span class="comment"> * 其中包含了多个版本的get 方法，方法声明抛出检查异常.这样使得创建一个在执行逻辑中可以抛出异常的Future更加容易</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * JdkFutureAdapters.listenInPoolThread(jdkthread): guava同时提供了将JDK Future转换为ListenableFuture的接口函数。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeniorListenableFutureController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ListeningExecutorService listeningExecutorService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OuterService outerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/senior"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用用户服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; userServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.userService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用订单服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; orderServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.orderService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用商品服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; itemServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.itemService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//注册商品服务回调</span></span><br><span class="line">        addCallBack(itemServiceFuture);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// .......</span></span><br><span class="line">        <span class="comment">// 对多个ListenableFuture的合并，返回一个当所有Future成功时返回多个Future返回值组成的List对象。</span></span><br><span class="line">        <span class="comment">// 注：当其中一个Future失败或者取消的时候，会怎样？</span></span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;List&lt;Long&gt;&gt; threeServicesFutures = Futures.successfulAsList(userServiceFuture, orderServiceFuture, itemServiceFuture);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对于多个ListenableFuture的进行转换，返回一个新的ListenableFuture</span></span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;Long&gt; transform = Futures.transformAsync(threeServicesFutures, <span class="keyword">new</span> AsyncFunction&lt;List&lt;Long&gt;, Long&gt;() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 用给定的输入封装一个特定的ListenableFuture作为输出</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> input 输入的ListenableFuture对象</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ListenableFuture&lt;Long&gt; <span class="title">apply</span><span class="params">(@Nullable List&lt;Long&gt; input)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (input == <span class="keyword">null</span> || input.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 这里可以对input进行复杂的处理，返回最终的一个结果</span></span><br><span class="line">                <span class="comment">// 比如：对用户服务，订单服务，商品服务的远程调用结果进行封装</span></span><br><span class="line">                <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (Long serviceResult : input) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (serviceResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        result += serviceResult;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 立即返回一个带返回值的ListenableFuture</span></span><br><span class="line">                <span class="keyword">return</span> Futures.immediateFuture(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, listeningExecutorService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用地址服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; addressServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.addressService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;List&lt;Long&gt;&gt; finalFutures = Futures.successfulAsList(transform, addressServiceFuture);</span><br><span class="line"></span><br><span class="line">        ListenableFuture&lt;Long&gt; finalResult = Futures.transformAsync(finalFutures, <span class="keyword">new</span> AsyncFunction&lt;List&lt;Long&gt;, Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ListenableFuture&lt;Long&gt; <span class="title">apply</span><span class="params">(@Nullable List&lt;Long&gt; input)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (CollectionUtils.isEmpty(input)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 这里可以对input进行复杂的处理，返回最终的一个结果</span></span><br><span class="line">                <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">                <span class="comment">// 比如：对上面的用户服务，订单服务，商品服务的总结果和地址服务再封装</span></span><br><span class="line">                <span class="keyword">for</span> (Long serviceResult : input) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (serviceResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        result += serviceResult;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 立即返回一个带返回值的ListenableFuture</span></span><br><span class="line">                <span class="keyword">return</span> Futures.immediateFuture(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, listeningExecutorService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册回调事件</span></span><br><span class="line">        addCallBack(finalResult);</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        String time = <span class="string">"总调用时间是："</span> + (end - start) + <span class="string">"毫秒"</span>;</span><br><span class="line">        <span class="comment">//为什么要初始化4个容量的Map</span></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        resultMap.put(<span class="string">"time"</span>, time);</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> listenableFuture</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCallBack</span><span class="params">(ListenableFuture&lt;Long&gt; listenableFuture)</span> </span>&#123;</span><br><span class="line">        Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallback&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(@Nullable Long result)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"服务调用成功,执行结果是%s%n"</span>,result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"服务调用异常%s%n"</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, listeningExecutorService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:  JdkFutureAdapters.listenInPoolThread(jdkthread)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * guava同时提供了将JDK Future转换为ListenableFuture的接口函数。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkFutureAdaptersController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ListeningExecutorService listeningExecutorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/adapter"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 固定大小的线程池 核心线程数和最大线程数=10</span></span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">        Long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 一个耗时的任务</span></span><br><span class="line">        Future&lt;Boolean&gt; future = executorService.submit(<span class="keyword">new</span> Callable&lt;Boolean&gt;() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * Computes a result, or throws an exception if unable to do so.</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> computed result</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Exception if unable to compute a result</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">//模拟耗时5s</span></span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ListenableFuture listenableFuture = JdkFutureAdapters.listenInPoolThread(future);</span><br><span class="line">        Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallBackTask(), listeningExecutorService);</span><br><span class="line">        <span class="comment">// 记录结束时间</span></span><br><span class="line">        Long end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 执行时间</span></span><br><span class="line">        System.out.println(<span class="string">"线程执行结束了，耗时="</span> + (end - start) + <span class="string">"毫秒"</span>);</span><br><span class="line">        System.out.println(<span class="string">"-----------------------华丽的分割线-----------------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://github.com/online-demo/yunxi-guava-thread" target="_blank" rel="noopener">https://github.com/online-demo/yunxi-guava-thread</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/08/12/云析学院-原生JDK线程扩展-Guava/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/07/01/集群无忧-SpringSession原理与坑/">
                            集群无忧-SpringSession原理与坑
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-07-01T22:13:23+08:00">
	
		    7月 01, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>nginx 80</p>
<ul>
<li>高并发负载均衡、高可用</li>
</ul>
<p>session</p>
<ul>
<li>跟踪会话信息</li>
<li>电商网站不登录加入购物车</li>
<li>登录 — 标志 — session会话 属于哪个用户</li>
</ul>
<p>ip_hash负载算法缺点</p>
<ul>
<li>单点故障</li>
<li>IP – 真的能够不变？</li>
</ul>
<ol>
<li>移动、联通、— 宽带</li>
<li>移动互联网 — 不同区域ip变化</li>
</ol>
<p>redis</p>
<ul>
<li>理解为一个JVM外置的Map</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-session-data-redis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableRedisHttpSession</span> <span class="comment">// 启用redis存储session功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LettuceConnectionFactory <span class="title">connectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.配置一个redis客户端 -- 默认连接 127.0.0.1:6379</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LettuceConnectionFactory();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Initializer</span> <span class="keyword">extends</span> <span class="title">AbstractHttpSessionApplicationInitializer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Initializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(Config.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/07/01/集群无忧-SpringSession原理与坑/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/09/typescript常用操作/">
                            typescript常用操作
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-09T22:57:45+08:00">
	
		    5月 09, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="保留两位小数"><a href="#保留两位小数" class="headerlink" title="保留两位小数"></a>保留两位小数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Math.floor(15.7784514000 * 100) / 100 // 输出结果为 15.77</span><br><span class="line">parseInt(7/2) // 丢弃小数部分,保留整数部分</span><br><span class="line"></span><br><span class="line">const a = 2.461;</span><br><span class="line">const b = (parseInt(a * 100) / 100).toFixed(2); // 2.46</span><br></pre></td></tr></table></figure>
<h3 id="创建Map并赋值"><a href="#创建Map并赋值" class="headerlink" title="创建Map并赋值"></a>创建Map并赋值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const map = new Map([[2, &apos;foo&apos;], [1, &apos;bar&apos;]]);</span><br></pre></td></tr></table></figure>
<h3 id="判断Map类型"><a href="#判断Map类型" class="headerlink" title="判断Map类型"></a>判断Map类型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isMap(obj) &#123;</span><br><span class="line">  return obj instanceof Map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除数组中的某个元素"><a href="#删除数组中的某个元素" class="headerlink" title="删除数组中的某个元素"></a>删除数组中的某个元素</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const arr = [&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;];</span><br><span class="line">arr.splice(1,1);</span><br><span class="line">console.log(arr); //[&apos;a&apos;,&apos;c&apos;,&apos;d&apos;];</span><br></pre></td></tr></table></figure>
<h3 id="Object转成Map"><a href="#Object转成Map" class="headerlink" title="Object转成Map"></a>Object转成Map</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const result = new Map(Object.entries(map));</span><br></pre></td></tr></table></figure>
<h3 id="将Map的key、value转成数组"><a href="#将Map的key、value转成数组" class="headerlink" title="将Map的key、value转成数组"></a>将Map的key、value转成数组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const values = Array.from(map.values());</span><br><span class="line">const keys = Array.from(map.keys());</span><br></pre></td></tr></table></figure>
<h3 id="求数组最大值"><a href="#求数组最大值" class="headerlink" title="求数组最大值"></a>求数组最大值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const maxN = Math.max.apply(null,ary);</span><br><span class="line">const minN = Math.min.apply(null,ary);</span><br></pre></td></tr></table></figure>
<h3 id="实现Map的深克隆"><a href="#实现Map的深克隆" class="headerlink" title="实现Map的深克隆"></a>实现Map的深克隆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export class MapUtils &#123;</span><br><span class="line">    public static deepClone(obj) &#123;</span><br><span class="line">        if (!obj || true === obj) &#123; // this also handles boolean as true and false</span><br><span class="line">            return obj;</span><br><span class="line">        &#125;</span><br><span class="line">        const objType = typeof(obj);</span><br><span class="line">        if (&apos;number&apos; === objType || &apos;string&apos; === objType) &#123; // add your immutables here</span><br><span class="line">            return obj;</span><br><span class="line">        &#125;</span><br><span class="line">        const result = Array.isArray(obj) ? [] : !obj.constructor ? &#123;&#125; : new obj.constructor();</span><br><span class="line">        if (obj instanceof Map) &#123;</span><br><span class="line">            for (const key of obj.keys()) &#123;</span><br><span class="line">                result.set(key, this.deepClone(obj.get(key)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for (const key in obj) &#123;</span><br><span class="line">            if (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">                result[key] = this.deepClone(obj[key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://stackoverflow.com/questions/8206988/clone-copy-a-map-instance/39643085#39643085" target="_blank" rel="noopener">https://stackoverflow.com/questions/8206988/clone-copy-a-map-instance/39643085#39643085</a></p>
<h3 id="请求的url后面添加时间戳参数或者随机数的参数"><a href="#请求的url后面添加时间戳参数或者随机数的参数" class="headerlink" title="请求的url后面添加时间戳参数或者随机数的参数"></a>请求的url后面添加时间戳参数或者随机数的参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 添加时间戳</span><br><span class="line">...?time=new Date();</span><br><span class="line">// 添加随机数</span><br><span class="line">...?number=Math.random();</span><br><span class="line">//</span><br><span class="line">&quot;...?&quot; + Math.floor(Math.random() * 100)</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/09/typescript常用操作/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/05/feign/">
                            feign接口调用如何获取请求头
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-05T20:29:00+08:00">
	
		    5月 05, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class TestController &#123;</span><br><span class="line">  @Autowired</span><br><span class="line">  private ReciveClient reciveClient;</span><br><span class="line"></span><br><span class="line">  @GetMapping(&quot;/request&quot;)</span><br><span class="line">  public void request() &#123;</span><br><span class="line">    Response response = reciveClient.recive();</span><br><span class="line">    System.out.println(response.headers());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class ReciveController &#123;</span><br><span class="line">  @GetMapping(&quot;/recive&quot;)</span><br><span class="line">  public String recive() &#123;</span><br><span class="line">    return &quot;hello world&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient</span><br><span class="line">public interface ReciveClient &#123;</span><br><span class="line">  @GetMapping(&quot;/recive&quot;)</span><br><span class="line">  public Response recive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://stackoverflow.com/questions/38742191/get-headers-feign-netflix" target="_blank" rel="noopener">https://stackoverflow.com/questions/38742191/get-headers-feign-netflix</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/05/feign/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/05/logback/">
                            Logback日志配置
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-05T16:52:54+08:00">
	
		    5月 05, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/logback/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/logback/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h3 id="Logback的主要模块"><a href="#Logback的主要模块" class="headerlink" title="Logback的主要模块"></a>Logback的主要模块</h3><h4 id="logback-access"><a href="#logback-access" class="headerlink" title="logback-access"></a>logback-access</h4><p>与server容器集成，提供通过http来访问日志的功能，我们的第三方软件可以通过logback-access来访问到logback里面记录的日志，例如kibanner等都会用到这个模块。</p>
<h4 id="logback-classic"><a href="#logback-classic" class="headerlink" title="logback-classic"></a>logback-classic</h4><p>log4j的改良版本，同时完整的实现了slef4j api，使你可以很方便的更换成其他的日志系统，比如log4j等。</p>
<h4 id="logback-core"><a href="#logback-core" class="headerlink" title="logback-core"></a>logback-core</h4><p>为我们前两个模块提供了基础的服务。</p>
<h3 id="Logback的主要标签"><a href="#Logback的主要标签" class="headerlink" title="Logback的主要标签"></a>Logback的主要标签</h3><h4 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h4><p>作为日志的记录器，主要用于存放日志对象，也可以定义日志的类型还有级别等。</p>
<h4 id="appender"><a href="#appender" class="headerlink" title="appender"></a>appender</h4><p>用于指定日志输出的目的地，可以是控制台、文件、远程套接字服务器等。</p>
<h4 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h4><p>用于格式化日志信息输出的。</p>
<h3 id="Logback的加载顺序"><a href="#Logback的加载顺序" class="headerlink" title="Logback的加载顺序"></a>Logback的加载顺序</h3><p>程序在运行的时候会按照一定的顺序去加载我们logback相关的配置文件</p>
<h4 id="1-如果我们在配置里面指定了logback-configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件"><a href="#1-如果我们在配置里面指定了logback-configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件" class="headerlink" title="1.如果我们在配置里面指定了logback.configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件"></a>1.如果我们在配置里面指定了logback.configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dlogback.configurationFile=xxxxxx/xxx.xml</span><br></pre></td></tr></table></figure>
<h4 id="2-如果没有配置这个属性他将会加载我们classpath下的logback-groovy文件"><a href="#2-如果没有配置这个属性他将会加载我们classpath下的logback-groovy文件" class="headerlink" title="2.如果没有配置这个属性他将会加载我们classpath下的logback.groovy文件"></a>2.如果没有配置这个属性他将会加载我们classpath下的logback.groovy文件</h4><h4 id="3-如果也找不到这个文件，才会加载同级目录下的logback-test-xml文件"><a href="#3-如果也找不到这个文件，才会加载同级目录下的logback-test-xml文件" class="headerlink" title="3.如果也找不到这个文件，才会加载同级目录下的logback-test.xml文件"></a>3.如果也找不到这个文件，才会加载同级目录下的logback-test.xml文件</h4><h4 id="4-如果也没有，它就会加载logback-xml文件"><a href="#4-如果也没有，它就会加载logback-xml文件" class="headerlink" title="4.如果也没有，它就会加载logback.xml文件"></a>4.如果也没有，它就会加载logback.xml文件</h4><h4 id="5-如果都没找到上述的配置文件，jdk1-6以上就会调用service-provider-loading-facility去查找com-qos-logback-classic-spi-Configurator这个接口的第一个实现类"><a href="#5-如果都没找到上述的配置文件，jdk1-6以上就会调用service-provider-loading-facility去查找com-qos-logback-classic-spi-Configurator这个接口的第一个实现类" class="headerlink" title="5.如果都没找到上述的配置文件，jdk1.6以上就会调用service-provider loading facility去查找com.qos.logback.classic.spi.Configurator这个接口的第一个实现类"></a>5.如果都没找到上述的配置文件，jdk1.6以上就会调用service-provider loading facility去查找com.qos.logback.classic.spi.Configurator这个接口的第一个实现类</h4><h4 id="6-如果上面的都没有，则会使用ch-qos-logback-classic-BasicConfigurator这个实现类，就是直接在控制台输出"><a href="#6-如果上面的都没有，则会使用ch-qos-logback-classic-BasicConfigurator这个实现类，就是直接在控制台输出" class="headerlink" title="6.如果上面的都没有，则会使用ch.qos.logback.classic.BasicConfigurator这个实现类，就是直接在控制台输出"></a>6.如果上面的都没有，则会使用ch.qos.logback.classic.BasicConfigurator这个实现类，就是直接在控制台输出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;!-- scan=&quot;true&quot; 如果配置文件被改变，将会重新去加载 --&gt;</span><br><span class="line">&lt;!-- scanPeriod 设置监测我们的配置文件是否有修改时间的时间间隔，默认单位是毫秒，当scan为true时生效，每分钟扫一下配置文件看有没有发生变化如果有变化就会重新去加载配置，这样就不需要重启服务器 --&gt;</span><br><span class="line">&lt;!-- debug 打印出logback的内部信息 实时查看logback的运行状态 --&gt;</span><br><span class="line">&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt;</span><br><span class="line">	&lt;!-- 定义参数常量 --&gt;</span><br><span class="line">	&lt;!-- TRACE&lt;DEBUG&lt;INFO&lt;WARN&lt;ERROR &gt;以上的级别才会显示--&gt;</span><br><span class="line">	&lt;property name=&quot;log.level&quot; value=&quot;debug&quot; /&gt;</span><br><span class="line">	&lt;!-- 文件保留的时长 --&gt;</span><br><span class="line">	&lt;property name=&quot;log.maxHistory&quot; value=&quot;30&quot; /&gt;</span><br><span class="line">	&lt;!-- 日志存储的根路径 --&gt;</span><br><span class="line">	&lt;property name=&quot;log.filePath&quot; value=&quot;$&#123;catalina.base&#125;/logs/webapps&quot; /&gt;</span><br><span class="line">	&lt;!-- 日志展示的格式 --&gt;</span><br><span class="line">	&lt;property name=&quot;log.pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; -</span><br><span class="line">		%msg%n&quot; /&gt;</span><br><span class="line">	&lt;!-- 控制台设置 --&gt;</span><br><span class="line">	&lt;appender name=&quot;consoleAppender&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">		&lt;!-- 将一个event事件转化为一组byte数组，还会将转化后的数据输出到文件中 --&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- DEBUG --&gt;</span><br><span class="line">	&lt;!-- 随着大小或时间滚动日志 --&gt;</span><br><span class="line">	&lt;appender name=&quot;debugAppender&quot; class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">		&lt;!-- 文件路径 --&gt;</span><br><span class="line">		&lt;file&gt;$&#123;log.filePath&#125;/debug.log&lt;/file&gt;</span><br><span class="line">		&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">			&lt;!-- 文件名称 --&gt;</span><br><span class="line">			&lt;fileNamePattern&gt;$&#123;log.filePath&#125;/debug/debug.%d&#123;yyyy-MM-dd&#125;.%i.log.gz&lt;/fileNamePattern&gt;</span><br><span class="line">			&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">			&lt;maxHistory&gt;$&#123;log.maxHistory&#125;&lt;/maxHistory&gt;</span><br><span class="line">		&lt;/rollingPolicy&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">		&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">			&lt;level&gt;DEBUG&lt;/level&gt;</span><br><span class="line">			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">		&lt;/filter&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- INFO --&gt;</span><br><span class="line">	&lt;appender name=&quot;infoAppender&quot; class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">		&lt;!-- 文件路径 --&gt;</span><br><span class="line">		&lt;file&gt;$&#123;log.filePath&#125;/info.log&lt;/file&gt;</span><br><span class="line">		&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">			&lt;!-- 文件名称 --&gt;</span><br><span class="line">			&lt;fileNamePattern&gt;$&#123;log.filePath&#125;/info/info.%d&#123;yyyy-MM-dd&#125;.%i.log.gz&lt;/fileNamePattern&gt;</span><br><span class="line">			&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">			&lt;maxHistory&gt;$&#123;log.maxHistory&#125;&lt;/maxHistory&gt;</span><br><span class="line">		&lt;/rollingPolicy&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">		&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">			&lt;level&gt;INFO&lt;/level&gt;</span><br><span class="line">			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">		&lt;/filter&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- ERROR --&gt;</span><br><span class="line">	&lt;appender name=&quot;errorAppender&quot; class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">		&lt;!-- 文件路径 --&gt;</span><br><span class="line">		&lt;file&gt;$&#123;log.filePath&#125;/error.log&lt;/file&gt;</span><br><span class="line">		&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">			&lt;!-- 文件名称 --&gt;</span><br><span class="line">			&lt;fileNamePattern&gt;$&#123;log.filePath&#125;/error/error.%d&#123;yyyy-MM-dd&#125;.%i.log.gz&lt;/fileNamePattern&gt;</span><br><span class="line">			&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">			&lt;maxHistory&gt;$&#123;log.maxHistory&#125;&lt;/maxHistory&gt;</span><br><span class="line">		&lt;/rollingPolicy&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">		&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">			&lt;level&gt;ERROR&lt;/level&gt;</span><br><span class="line">			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">		&lt;/filter&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- logger 存放日志对象，同时告诉我们logback我们需要关注哪个package下的信息 --&gt;</span><br><span class="line">	&lt;!-- additivity 如果additivity为true那么root下面的appender也会想到logger下面 --&gt;</span><br><span class="line">	&lt;logger name=&quot;com.brotherc.demo&quot; level=&quot;$&#123;log.level&#125;&quot; additivity=&quot;true&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;debugAppender&quot; /&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;infoAppender&quot; /&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;errorAppender&quot; /&gt;</span><br><span class="line">	&lt;/logger&gt;</span><br><span class="line">	&lt;!--root 就是特殊的logger，根logger。如果logger没有指定level，默认继承root --&gt;</span><br><span class="line">	&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;consoleAppender&quot; /&gt;</span><br><span class="line">	&lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/05/logback/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/04/分布式事务/">
                            分布式事务
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-04T19:43:32+08:00">
	
		    5月 04, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h5 id="两段式：2PC"><a href="#两段式：2PC" class="headerlink" title="两段式：2PC"></a>两段式：2PC</h5><h5 id="三段式：3PC"><a href="#三段式：3PC" class="headerlink" title="三段式：3PC"></a>三段式：3PC</h5><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h5 id="1-需要提供分布式事务支持的接口上添加-Compensable"><a href="#1-需要提供分布式事务支持的接口上添加-Compensable" class="headerlink" title="1.需要提供分布式事务支持的接口上添加@Compensable"></a>1.需要提供分布式事务支持的接口上添加@Compensable</h5><h5 id="2-在对应的接口实现上添加-Compensable"><a href="#2-在对应的接口实现上添加-Compensable" class="headerlink" title="2.在对应的接口实现上添加@Compensable"></a>2.在对应的接口实现上添加@Compensable</h5><h5 id="3-在接口上添加confirmMethod、cancelMethod、transactionContextEditor"><a href="#3-在接口上添加confirmMethod、cancelMethod、transactionContextEditor" class="headerlink" title="3.在接口上添加confirmMethod、cancelMethod、transactionContextEditor"></a>3.在接口上添加confirmMethod、cancelMethod、transactionContextEditor</h5><h5 id="4-实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）"><a href="#4-实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）" class="headerlink" title="4.实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）"></a>4.实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）</h5><h5 id="5-主事务的业务都已经实现的差不多的时候才调用子事务"><a href="#5-主事务的业务都已经实现的差不多的时候才调用子事务" class="headerlink" title="5.主事务的业务都已经实现的差不多的时候才调用子事务"></a>5.主事务的业务都已经实现的差不多的时候才调用子事务</h5><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><h5 id="1-分布式事务里，不要轻易在业务层捕获所有异常"><a href="#1-分布式事务里，不要轻易在业务层捕获所有异常" class="headerlink" title="1.分布式事务里，不要轻易在业务层捕获所有异常"></a>1.分布式事务里，不要轻易在业务层捕获所有异常</h5><h5 id="2-使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持"><a href="#2-使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持" class="headerlink" title="2.使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持"></a>2.使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持</h5><h5 id="幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同"><a href="#幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同" class="headerlink" title="幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同"></a>幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同</h5><p>参考：<br><a href="https://github.com/changmingxie/tcc-transaction" target="_blank" rel="noopener">https://github.com/changmingxie/tcc-transaction</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/04/分布式事务/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/04/18/加密类型及其相关算法/">
                            加密类型及其相关算法
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-04-18T14:50:24+08:00">
	
		    4月 18, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="一、数据传输安全性"><a href="#一、数据传输安全性" class="headerlink" title="一、数据传输安全性"></a>一、数据传输安全性</h2><h5 id="在TCP-IP层中不涉及安全"><a href="#在TCP-IP层中不涉及安全" class="headerlink" title="在TCP/IP层中不涉及安全"></a>在TCP/IP层中不涉及安全</h5><ul>
<li>机密性：明文传输（ftp,smtp,talnet）别人一拦截就能看到请求的内容。</li>
<li>完整性：10颗原子弹（被改成100）所以数据在互联网上传播的时候，不应该也不能够被其他人非法篡改掉。当收到的和发送的不一致时拒绝接受这就能保证数据的完整性。</li>
<li>身份验证：通过有效的手段保证所访问的对象就是我们所要的那个人。</li>
</ul>
<h4 id="保证数据的机密性"><a href="#保证数据的机密性" class="headerlink" title="保证数据的机密性"></a>保证数据的机密性</h4><ul>
<li>plaintext(明文) –&gt; 加密（转换规则）–&gt; ciphertext（密文）</li>
<li>ciphertext –&gt; 转换规则 –&gt; plaintext</li>
<li>转换算法：依赖密钥（即使得到了转换规则也没用）</li>
<li>对称加密：加密和解密使用同一个密钥（有加密算法和解密算法，算法不同，但密钥相同）。<br>好处是计算速度快，在一定程度上解决了机密性问题。坏处是不能解决密钥有效管理的问题。<br>假如a跟b，c,d通信，如果密钥相同，则c只要用密钥就可以看到a发送给b的内容，显然密钥不能相同，<br>那就得维护很多密钥。</li>
</ul>
<h4 id="保证数据的完整性"><a href="#保证数据的完整性" class="headerlink" title="保证数据的完整性"></a>保证数据的完整性</h4><ul>
<li>A：plaintext:footprint –&gt; B<br>B使用同样的加密算法去重复计算这个明文的特征码，并跟A所发过来的特征码进行比较，<br>如果一样，则说明没被篡改。</li>
<li>单项加密算法：提取数据特征码，追加到数据后面。数据的输入一样：特征码必然相同。</li>
<li>特点：<br>输入一样，输出必然相同<br>雪崩效应（输入的微小改变，将其会引起结果的巨大改变）<br>定长输出（无论原始数据是多长，结果大小都是相同的）<br>不可逆（无法根据原始特征码还原原来的数据）</li>
</ul>
<h4 id="中间人攻击问题"><a href="#中间人攻击问题" class="headerlink" title="中间人攻击问题"></a>中间人攻击问题</h4><ul>
<li>E(A)：plaintext2:footprint2 –&gt; B<br>A生成一段数据，并对它计算特征码，E在中间经过的路由时拿到这个明文，并重新修改明文和再计算特征码发给B，还声称自己是A，B拿到数据之后就算使用了数据完整性的算法之后，计算特征码还是一模一样，还认为是A发过来的，所以需要借助额外的机制。</li>
<li>解决办法：A：plaintext:footprint(加密) –&gt; B B拿到特征码之后通过密钥进行解密，能解密<br>说明数据没有被改过。如果E拿到plaintext并修改为plaintext2，并重新生成特征码，就没办法加密<br>特征码或者加密后就不是A和B之间实现约定的密码。</li>
</ul>
<h4 id="A与B之间如何进行密码约定"><a href="#A与B之间如何进行密码约定" class="headerlink" title="A与B之间如何进行密码约定"></a>A与B之间如何进行密码约定</h4><ul>
<li>假如A与B之间从未通信或从未见过面，如何进行密码约定呢？</li>
<li>协商生成密码：密码交换（Internet Key Exchange / IKE）,密码交换是不让第三方得到密钥，<br>密码交换需要特殊的互联网协议支撑。比如：Dffie-Hellman协议。</li>
<li>A和B事先约定两个数p(大素数)，g(生成数)。A生成一个自己知道的x，B生成一个自己知道的y。<br>A将 g^x % p 发送给B，B将g^y % p 发送给A。<br>A拿到之后进行计算 （g^y % p）^x = g^xy % p，<br>B拿到之后进行计算 （g^x % p）^y = g^xy % p。<br>这个相同的结果就是密钥。<br>在互联网上可以看到g、p、g^x % p、g^y % p，但看不到x、y。</li>
<li>A和B只需要选好几个数，让这些数的计算结果作为密钥来用，使得彼此不用计算密码，只要双方<br>生成密钥的软件一样就可以随时生成密钥。</li>
</ul>
<h4 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h4><ul>
<li>之前是A和B一起约定好的密码，所以身份验证没问题。但是密钥是交换生成的，事先之前谁也不知道。<br>E跳出来，截取了数据并篡改，然后与B进行连接通信，还告诉它自己是A。</li>
<li>解决办法：公钥加密算法（非对称加密算法）</li>
<li>特点：拥有一对密钥对，分别是公钥（是从私钥中提取出来的）、私钥。用公钥加密的，只能用私钥<br>解密，反之亦然。</li>
</ul>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><ul>
<li>机密性：用B的公钥加密，B的私钥解密。发送方用对方的公钥加密数据，可以保证数据机密性。</li>
<li>身份验证：用A的私钥加密，A的公钥解密。发送方用自己的私钥加密数据，可以实现身份验证。</li>
<li>公钥加密算法很少用来加密数据：速度太慢。非对称加密的主要作用也就是身份验证。</li>
</ul>
<h2 id="二、数据传输"><a href="#二、数据传输" class="headerlink" title="二、数据传输"></a>二、数据传输</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/数据传输.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/数据传输.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>PKI:公钥基础设施(Public Key Infrastructure) 核心就是CA和彼此之间的信任关系<br>CA:证书颁发机构(Certificate Authority)，CA中还维护了CRL<br>CRL:证书撤销列表，CRL中保存了此前曾经发出去的证书，但仍未过期，只不过已经各种原因被撤销了</p>
<h2 id="三、TLS-SSL"><a href="#三、TLS-SSL" class="headerlink" title="三、TLS/SSL"></a>三、TLS/SSL</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h3 id="不同标准下的证书格式是不同的"><a href="#不同标准下的证书格式是不同的" class="headerlink" title="不同标准下的证书格式是不同的"></a>不同标准下的证书格式是不同的</h3><p>比如x509, pkcs12<br>x509: 公钥及其有效期限，证书的合法拥有者，证书该如何被使用，CA的信息，CA签名的校验码<br>TLS/SSL所使用的正是x509的证书，TLS/SSL其实就是一种PKI，PKI的第二种实现OpenGPG</p>
<h3 id="TLS-SSL-如何实现握手认证、密钥交换"><a href="#TLS-SSL-如何实现握手认证、密钥交换" class="headerlink" title="TLS/SSL 如何实现握手认证、密钥交换"></a>TLS/SSL 如何实现握手认证、密钥交换</h3><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="四、加密"><a href="#四、加密" class="headerlink" title="四、加密"></a>四、加密</h2><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>加密解密使用同一个密码</p>
<ul>
<li>DES(Data Encrption Standard, 56bit)</li>
<li>3DES</li>
<li>AES(Advanced, AES192/AES256/AES512)</li>
<li>Blowfish</li>
</ul>
<h3 id="单向加密"><a href="#单向加密" class="headerlink" title="单向加密"></a>单向加密</h3><ul>
<li>MD4</li>
<li>MD5</li>
<li>SHA1</li>
<li>SHA192、SHA256、SHA384</li>
<li>CRC-32</li>
</ul>
<h3 id="非对称加密（公钥加密）"><a href="#非对称加密（公钥加密）" class="headerlink" title="非对称加密（公钥加密）"></a>非对称加密（公钥加密）</h3><p>身份认证（数字签名）、数据加密、密钥交换</p>
<ul>
<li>RSA(加密、签名)</li>
<li>DSA(签名)</li>
<li>ElGamal</li>
</ul>
<h3 id="加密实现"><a href="#加密实现" class="headerlink" title="加密实现"></a>加密实现</h3><p>OpenSSL: SSL的开源实现<br>  libcryptc: 通用的加密库<br>  libssl: TLS/SSL的实现<br>    基于会话的、实现了省份认证、数据机密性和会话完整性的TLS/SSL库<br>  openssl: 多用途命令行工具<br>    实现私有证书颁发机构</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/04/18/加密类型及其相关算法/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/page/2/">
              <span>下一页</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 1 页 共 9 页</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Brotherc. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/head.jpg" alt="作者的图片">
        
            <h4 id="about-card-name">Brotherc</h4>
        
            <div id="about-card-bio"><p>java development</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>java</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                zhuhai
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
