
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Brotherc">
    <title>归档: 2020 - Brotherc</title>
    <meta name="author" content="Brotherc">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Brotherc">
<meta property="og:url" content="http://yoursite.com/archives/2020/index.html">
<meta property="og:site_name" content="Brotherc">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brotherc">
    
    
        
    
    
        <meta property="og:image" content="http://yoursite.com/assets/images/head.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Brotherc</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="/assets/images/head.jpg" alt="作者的图片">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/head.jpg" alt="作者的图片">
                </a>
                <h4 class="sidebar-profile-name">Brotherc</h4>
                
                    <h5 class="sidebar-profile-bio"><p>java development</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="首页">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="分类">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="标签">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link open-algolia-search" href="/all-archives" title="归档">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="关于">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/Brotherc" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/08/14/JAVA实现对称加密/">
                            JAVA实现对称加密
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-08-14T00:00:07+08:00">
	
		    8月 14, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="对称加密算法DES"><a href="#对称加密算法DES" class="headerlink" title="对称加密算法DES"></a>对称加密算法DES</h2><ul>
<li>软件、硬件</li>
<li>加密密钥=解密密钥</li>
<li>初等、DES(3DES)、AES、PBE、IDEA</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DESTest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"des test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkDES();</span><br><span class="line">		bcDES();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkDES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"DES"</span>);			</span><br><span class="line">			keyGenerator.init(<span class="number">56</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytesKey = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			DESKeySpec desKeySpec = <span class="keyword">new</span> DESKeySpec(bytesKey);</span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"DES"</span>);</span><br><span class="line">			Key convertSecretKey = factory.generateSecret(desKeySpec);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, convertSecretKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk des encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, convertSecretKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"jdk des decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcDES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"DES"</span>, <span class="string">"BC"</span>);</span><br><span class="line">			keyGenerator.getProvider();</span><br><span class="line">			keyGenerator.init(<span class="number">56</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytesKey = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			DESKeySpec desKeySpec = <span class="keyword">new</span> DESKeySpec(bytesKey);</span><br><span class="line">			SecretKeyFactory factory = SecretKeyFactory.getInstance(<span class="string">"DES"</span>);</span><br><span class="line">			Key convertSecretKey = factory.generateSecret(desKeySpec);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"DES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, convertSecretKey);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc des encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, convertSecretKey);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"bc des decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="对称加密算法AES"><a href="#对称加密算法AES" class="headerlink" title="对称加密算法AES"></a>对称加密算法AES</h2><ul>
<li>AES是目前使用最多的对称加密算法</li>
<li>AES的优势之一是至今尚未被破解</li>
<li>AES通常用于移动通信系统加密以及基于SSH协议的软件(SSH Client、secureCRT)</li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AESTest</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String src = <span class="string">"aes test"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		jdkAES();</span><br><span class="line">		bcAES();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用jdk实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jdkAES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"AES"</span>);			</span><br><span class="line">			keyGenerator.init(<span class="number">128</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] keyBytes = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			Key key = <span class="keyword">new</span> SecretKeySpec(keyBytes, <span class="string">"AES"</span>);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"AES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"jdk aes encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"jdk aes decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 用bouncy castle实现:</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bcAES</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 生成KEY</span></span><br><span class="line">			KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="string">"AES"</span>, <span class="string">"BC"</span>);	</span><br><span class="line">			keyGenerator.getProvider();</span><br><span class="line">			keyGenerator.init(<span class="number">128</span>);</span><br><span class="line">			<span class="comment">// 产生密钥</span></span><br><span class="line">			SecretKey secretKey = keyGenerator.generateKey();</span><br><span class="line">			<span class="comment">// 获取密钥</span></span><br><span class="line">			<span class="keyword">byte</span>[] keyBytes = secretKey.getEncoded();</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// KEY转换</span></span><br><span class="line">			Key key = <span class="keyword">new</span> SecretKeySpec(keyBytes, <span class="string">"AES"</span>);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(<span class="string">"AES/ECB/PKCS5Padding"</span>);</span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">			<span class="keyword">byte</span>[] result = cipher.doFinal(src.getBytes());</span><br><span class="line">			System.out.println(<span class="string">"bc aes encrypt:"</span> + Hex.encodeHexString(result));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">			result = cipher.doFinal(result);</span><br><span class="line">			System.out.println(<span class="string">"bc aes decrypt:"</span> + <span class="keyword">new</span> String(result));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/JAVA实现对称加密/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/JAVA实现对称加密/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>参考：<br><a href="https://github.com/online-demo/yunxi-guava-thread" target="_blank" rel="noopener">https://github.com/online-demo/yunxi-guava-thread</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/08/14/JAVA实现对称加密/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/08/12/云析学院-原生JDK线程扩展-Guava/">
                            原生JDK线程扩展-Guava
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-08-12T23:03:41+08:00">
	
		    8月 12, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="JDK线程"><a href="#JDK线程" class="headerlink" title="JDK线程"></a>JDK线程</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>针对以上串行场景，有什么优化方案</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>谈谈你对Java线程池的理解</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>以上方式就是最优解吗？</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/13.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/13.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/14.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/14.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<ul>
<li><strong>95线  95%请求  300ms</strong></li>
</ul>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/15.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/15.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/16.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/16.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/17.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/17.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/18.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/18.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Guava对JDK扩展"><a href="#Guava对JDK扩展" class="headerlink" title="Guava对JDK扩展"></a>Guava对JDK扩展</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/云析学院/原生JDK线程扩展-Guava/19.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/云析学院/原生JDK线程扩展-Guava/19.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="Guava实战"><a href="#Guava实战" class="headerlink" title="Guava实战"></a>Guava实战</h2><h5 id="模拟外部服务"><a href="#模拟外部服务" class="headerlink" title="模拟外部服务"></a>模拟外部服务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 模拟一个耗时的服务 如：RPC或者HTTP请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OuterService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">userService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"用户服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时1000ms的用户服务</span></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"用户服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设用户服务返回值=1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">orderService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"订单服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时2000ms的订单服务</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"订单服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设订单服务返回值=3</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">itemService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"商品服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时3000ms的商品服务</span></span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            <span class="comment">//模拟调用超时或者服务异常</span></span><br><span class="line">            <span class="comment">// throw new RuntimeException("Oh My God, OrderService Exception!!!");</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"商品服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设商品服务返回值=5</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 地址服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">addressService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"地址服务开始执行"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟耗时5000ms的地址服务</span></span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"地址服务执行结束"</span>);</span><br><span class="line">        <span class="comment">//假设地址服务返回值=7</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="单线程演示"><a href="#单线程演示" class="headerlink" title="单线程演示"></a>单线程演示</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 单线程操作演示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OuterService outerService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试代码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/single"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//开始调用的时间</span></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//同步调用用户服务</span></span><br><span class="line">        <span class="keyword">long</span> userServiceResult = outerService.userService();</span><br><span class="line">        <span class="comment">//同步调用订单服务</span></span><br><span class="line">        <span class="keyword">long</span> orderServiceResult = outerService.orderService();</span><br><span class="line">        <span class="comment">//同步调用商品服务</span></span><br><span class="line">        <span class="keyword">long</span> itemServiceResult = outerService.itemService();</span><br><span class="line">        <span class="comment">//结束调用的时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        String time = <span class="string">"总调用时间是："</span> + (end - start) + <span class="string">"毫秒"</span>;</span><br><span class="line">        <span class="comment">//计算结果</span></span><br><span class="line">        <span class="keyword">long</span> result = userServiceResult + orderServiceResult + itemServiceResult;</span><br><span class="line">        <span class="comment">//为什么要初始化4个容量的Map</span></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        resultMap.put(<span class="string">"time"</span>, time);</span><br><span class="line">        resultMap.put(<span class="string">"result"</span>, result);</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="JDK多线程演示"><a href="#JDK多线程演示" class="headerlink" title="JDK多线程演示"></a>JDK多线程演示</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: JDK多线程操作演示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkThreadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OuterService outerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/jdk"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 固定大小的线程池 核心线程数和最大线程数=10</span></span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">        Long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 异步调用用户服务</span></span><br><span class="line">        Future&lt;Long&gt; userServiceFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.userService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 异步调用订单服务</span></span><br><span class="line">        Future&lt;Long&gt; orderServiceFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.orderService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 异步调用商品服务</span></span><br><span class="line">        Future&lt;Long&gt; itemServiceFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.itemService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 阻塞 等待执行结果</span></span><br><span class="line">        <span class="keyword">long</span> userServiceResult = userServiceFuture.get();</span><br><span class="line">        <span class="keyword">long</span> orderServiceResult = orderServiceFuture.get();</span><br><span class="line">        <span class="keyword">long</span> itemServiceResult = itemServiceFuture.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//结束调用的时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//计算结果</span></span><br><span class="line">        <span class="keyword">long</span> result = userServiceResult + orderServiceResult + itemServiceResult;</span><br><span class="line">        String time = <span class="string">"总调用时间是："</span> + (end - start) + <span class="string">"毫秒"</span>;</span><br><span class="line">        <span class="comment">//为什么要初始化4个容量的Map</span></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        resultMap.put(<span class="string">"time"</span>, time);</span><br><span class="line">        resultMap.put(<span class="string">"result"</span>, result);</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Guava特性演示"><a href="#Guava特性演示" class="headerlink" title="Guava特性演示"></a>Guava特性演示</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.ListeningExecutorService;</span><br><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.MoreExecutors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 公用的线程池</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListeningExecutors</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListeningExecutorService <span class="title">createListeningExecutorService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建线程池</span></span><br><span class="line">        <span class="keyword">return</span> MoreExecutors.listeningDecorator(Executors.newFixedThreadPool(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.FutureCallback;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ListenableFuture回调任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureCallBackTask</span> <span class="keyword">implements</span> <span class="title">FutureCallback</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功的回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Object result)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//执行回调函数</span></span><br><span class="line">        System.out.println(<span class="string">"进入正确的回调函数"</span>);</span><br><span class="line">        <span class="comment">//得到任务执行的结果</span></span><br><span class="line">        System.out.printf(<span class="string">"任务执行的结果是：%s%n"</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败的回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> thrown</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable thrown)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"进入错误的回调函数"</span>);</span><br><span class="line">        System.out.printf(<span class="string">"系统出错了，错误原因是：%s%n"</span>, thrown.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Guava 线程简单测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuavaThreadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ListeningExecutorService listeningExecutorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/guava"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">        Long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 一个耗时的任务</span></span><br><span class="line">        ListenableFuture&lt;Boolean&gt; listenableFuture = listeningExecutorService.submit(() -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 注册回调事件</span></span><br><span class="line">        Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallBackTask(), listeningExecutorService);</span><br><span class="line">        <span class="comment">// 记录结束时间</span></span><br><span class="line">        Long end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 执行时间</span></span><br><span class="line">        System.out.println(<span class="string">"execute()方法执行结束了，耗时="</span> + (end - start) + <span class="string">"毫秒"</span>);</span><br><span class="line">        System.out.println(<span class="string">"-----------------------华丽的分割线-----------------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 高级特性介绍</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * transform：对于ListenableFuture的返回值进行转换。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * allAsList：对多个ListenableFuture的合并，返回一个当所有Future成功时返回多个Future返回值组成的List对象。</span></span><br><span class="line"><span class="comment"> * 注：当其中一个Future失败或者取消的时候，将会进入失败或者取消。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * successfulAsList：和allAsList相似，唯一差别是对于失败或取消的Future返回值用null代替。不会进入失败或者取消流程。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * immediateFuture/immediateCancelledFuture： 立即返回一个待返回值的ListenableFuture。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * makeChecked: 将ListenableFuture 转换成CheckedFuture。CheckedFuture 是一个ListenableFuture 。</span></span><br><span class="line"><span class="comment"> * 其中包含了多个版本的get 方法，方法声明抛出检查异常.这样使得创建一个在执行逻辑中可以抛出异常的Future更加容易</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * JdkFutureAdapters.listenInPoolThread(jdkthread): guava同时提供了将JDK Future转换为ListenableFuture的接口函数。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeniorListenableFutureController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ListeningExecutorService listeningExecutorService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OuterService outerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/senior"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用用户服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; userServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.userService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用订单服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; orderServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.orderService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用商品服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; itemServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.itemService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//注册商品服务回调</span></span><br><span class="line">        addCallBack(itemServiceFuture);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// .......</span></span><br><span class="line">        <span class="comment">// 对多个ListenableFuture的合并，返回一个当所有Future成功时返回多个Future返回值组成的List对象。</span></span><br><span class="line">        <span class="comment">// 注：当其中一个Future失败或者取消的时候，会怎样？</span></span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;List&lt;Long&gt;&gt; threeServicesFutures = Futures.successfulAsList(userServiceFuture, orderServiceFuture, itemServiceFuture);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对于多个ListenableFuture的进行转换，返回一个新的ListenableFuture</span></span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;Long&gt; transform = Futures.transformAsync(threeServicesFutures, <span class="keyword">new</span> AsyncFunction&lt;List&lt;Long&gt;, Long&gt;() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 用给定的输入封装一个特定的ListenableFuture作为输出</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> input 输入的ListenableFuture对象</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ListenableFuture&lt;Long&gt; <span class="title">apply</span><span class="params">(@Nullable List&lt;Long&gt; input)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (input == <span class="keyword">null</span> || input.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 这里可以对input进行复杂的处理，返回最终的一个结果</span></span><br><span class="line">                <span class="comment">// 比如：对用户服务，订单服务，商品服务的远程调用结果进行封装</span></span><br><span class="line">                <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (Long serviceResult : input) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (serviceResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        result += serviceResult;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 立即返回一个带返回值的ListenableFuture</span></span><br><span class="line">                <span class="keyword">return</span> Futures.immediateFuture(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, listeningExecutorService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步调用地址服务</span></span><br><span class="line">        ListenableFuture&lt;Long&gt; addressServiceFuture = listeningExecutorService.submit(<span class="keyword">new</span> Callable&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> outerService.addressService();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;List&lt;Long&gt;&gt; finalFutures = Futures.successfulAsList(transform, addressServiceFuture);</span><br><span class="line"></span><br><span class="line">        ListenableFuture&lt;Long&gt; finalResult = Futures.transformAsync(finalFutures, <span class="keyword">new</span> AsyncFunction&lt;List&lt;Long&gt;, Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ListenableFuture&lt;Long&gt; <span class="title">apply</span><span class="params">(@Nullable List&lt;Long&gt; input)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (CollectionUtils.isEmpty(input)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 这里可以对input进行复杂的处理，返回最终的一个结果</span></span><br><span class="line">                <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">                <span class="comment">// 比如：对上面的用户服务，订单服务，商品服务的总结果和地址服务再封装</span></span><br><span class="line">                <span class="keyword">for</span> (Long serviceResult : input) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (serviceResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        result += serviceResult;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 立即返回一个带返回值的ListenableFuture</span></span><br><span class="line">                <span class="keyword">return</span> Futures.immediateFuture(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, listeningExecutorService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册回调事件</span></span><br><span class="line">        addCallBack(finalResult);</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        String time = <span class="string">"总调用时间是："</span> + (end - start) + <span class="string">"毫秒"</span>;</span><br><span class="line">        <span class="comment">//为什么要初始化4个容量的Map</span></span><br><span class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        resultMap.put(<span class="string">"time"</span>, time);</span><br><span class="line">        <span class="comment">//结果</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> listenableFuture</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCallBack</span><span class="params">(ListenableFuture&lt;Long&gt; listenableFuture)</span> </span>&#123;</span><br><span class="line">        Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallback&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(@Nullable Long result)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"服务调用成功,执行结果是%s%n"</span>,result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                System.out.printf(<span class="string">"服务调用异常%s%n"</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, listeningExecutorService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:  JdkFutureAdapters.listenInPoolThread(jdkthread)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * guava同时提供了将JDK Future转换为ListenableFuture的接口函数。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkFutureAdaptersController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ListeningExecutorService listeningExecutorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/adapter"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 固定大小的线程池 核心线程数和最大线程数=10</span></span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 记录开始时间</span></span><br><span class="line">        Long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 一个耗时的任务</span></span><br><span class="line">        Future&lt;Boolean&gt; future = executorService.submit(<span class="keyword">new</span> Callable&lt;Boolean&gt;() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * Computes a result, or throws an exception if unable to do so.</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> computed result</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Exception if unable to compute a result</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">//模拟耗时5s</span></span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ListenableFuture listenableFuture = JdkFutureAdapters.listenInPoolThread(future);</span><br><span class="line">        Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallBackTask(), listeningExecutorService);</span><br><span class="line">        <span class="comment">// 记录结束时间</span></span><br><span class="line">        Long end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 执行时间</span></span><br><span class="line">        System.out.println(<span class="string">"线程执行结束了，耗时="</span> + (end - start) + <span class="string">"毫秒"</span>);</span><br><span class="line">        System.out.println(<span class="string">"-----------------------华丽的分割线-----------------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://github.com/online-demo/yunxi-guava-thread" target="_blank" rel="noopener">https://github.com/online-demo/yunxi-guava-thread</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/08/12/云析学院-原生JDK线程扩展-Guava/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/07/01/集群无忧-SpringSession原理与坑/">
                            集群无忧-SpringSession原理与坑
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-07-01T22:13:23+08:00">
	
		    7月 01, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>nginx 80</p>
<ul>
<li>高并发负载均衡、高可用</li>
</ul>
<p>session</p>
<ul>
<li>跟踪会话信息</li>
<li>电商网站不登录加入购物车</li>
<li>登录 — 标志 — session会话 属于哪个用户</li>
</ul>
<p>ip_hash负载算法缺点</p>
<ul>
<li>单点故障</li>
<li>IP – 真的能够不变？</li>
</ul>
<ol>
<li>移动、联通、— 宽带</li>
<li>移动互联网 — 不同区域ip变化</li>
</ol>
<p>redis</p>
<ul>
<li>理解为一个JVM外置的Map</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-session-data-redis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableRedisHttpSession</span> <span class="comment">// 启用redis存储session功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LettuceConnectionFactory <span class="title">connectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.配置一个redis客户端 -- 默认连接 127.0.0.1:6379</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LettuceConnectionFactory();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Initializer</span> <span class="keyword">extends</span> <span class="title">AbstractHttpSessionApplicationInitializer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Initializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(Config.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/集群无忧-SpringSession原理与坑/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/集群无忧-SpringSession原理与坑/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/07/01/集群无忧-SpringSession原理与坑/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/09/typescript常用操作/">
                            typescript常用操作
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-09T22:57:45+08:00">
	
		    5月 09, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="保留两位小数"><a href="#保留两位小数" class="headerlink" title="保留两位小数"></a>保留两位小数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Math.floor(15.7784514000 * 100) / 100 // 输出结果为 15.77</span><br><span class="line">parseInt(7/2) // 丢弃小数部分,保留整数部分</span><br><span class="line"></span><br><span class="line">const a = 2.461;</span><br><span class="line">const b = (parseInt(a * 100) / 100).toFixed(2); // 2.46</span><br></pre></td></tr></table></figure>
<h3 id="创建Map并赋值"><a href="#创建Map并赋值" class="headerlink" title="创建Map并赋值"></a>创建Map并赋值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const map = new Map([[2, &apos;foo&apos;], [1, &apos;bar&apos;]]);</span><br></pre></td></tr></table></figure>
<h3 id="判断Map类型"><a href="#判断Map类型" class="headerlink" title="判断Map类型"></a>判断Map类型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isMap(obj) &#123;</span><br><span class="line">  return obj instanceof Map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除数组中的某个元素"><a href="#删除数组中的某个元素" class="headerlink" title="删除数组中的某个元素"></a>删除数组中的某个元素</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const arr = [&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;];</span><br><span class="line">arr.splice(1,1);</span><br><span class="line">console.log(arr); //[&apos;a&apos;,&apos;c&apos;,&apos;d&apos;];</span><br></pre></td></tr></table></figure>
<h3 id="Object转成Map"><a href="#Object转成Map" class="headerlink" title="Object转成Map"></a>Object转成Map</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const result = new Map(Object.entries(map));</span><br></pre></td></tr></table></figure>
<h3 id="将Map的key、value转成数组"><a href="#将Map的key、value转成数组" class="headerlink" title="将Map的key、value转成数组"></a>将Map的key、value转成数组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const values = Array.from(map.values());</span><br><span class="line">const keys = Array.from(map.keys());</span><br></pre></td></tr></table></figure>
<h3 id="求数组最大值"><a href="#求数组最大值" class="headerlink" title="求数组最大值"></a>求数组最大值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const maxN = Math.max.apply(null,ary);</span><br><span class="line">const minN = Math.min.apply(null,ary);</span><br></pre></td></tr></table></figure>
<h3 id="实现Map的深克隆"><a href="#实现Map的深克隆" class="headerlink" title="实现Map的深克隆"></a>实现Map的深克隆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export class MapUtils &#123;</span><br><span class="line">    public static deepClone(obj) &#123;</span><br><span class="line">        if (!obj || true === obj) &#123; // this also handles boolean as true and false</span><br><span class="line">            return obj;</span><br><span class="line">        &#125;</span><br><span class="line">        const objType = typeof(obj);</span><br><span class="line">        if (&apos;number&apos; === objType || &apos;string&apos; === objType) &#123; // add your immutables here</span><br><span class="line">            return obj;</span><br><span class="line">        &#125;</span><br><span class="line">        const result = Array.isArray(obj) ? [] : !obj.constructor ? &#123;&#125; : new obj.constructor();</span><br><span class="line">        if (obj instanceof Map) &#123;</span><br><span class="line">            for (const key of obj.keys()) &#123;</span><br><span class="line">                result.set(key, this.deepClone(obj.get(key)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for (const key in obj) &#123;</span><br><span class="line">            if (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">                result[key] = this.deepClone(obj[key]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://stackoverflow.com/questions/8206988/clone-copy-a-map-instance/39643085#39643085" target="_blank" rel="noopener">https://stackoverflow.com/questions/8206988/clone-copy-a-map-instance/39643085#39643085</a></p>
<h3 id="请求的url后面添加时间戳参数或者随机数的参数"><a href="#请求的url后面添加时间戳参数或者随机数的参数" class="headerlink" title="请求的url后面添加时间戳参数或者随机数的参数"></a>请求的url后面添加时间戳参数或者随机数的参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 添加时间戳</span><br><span class="line">...?time=new Date();</span><br><span class="line">// 添加随机数</span><br><span class="line">...?number=Math.random();</span><br><span class="line">//</span><br><span class="line">&quot;...?&quot; + Math.floor(Math.random() * 100)</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/09/typescript常用操作/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/05/feign/">
                            feign接口调用如何获取请求头
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-05T20:29:00+08:00">
	
		    5月 05, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class TestController &#123;</span><br><span class="line">  @Autowired</span><br><span class="line">  private ReciveClient reciveClient;</span><br><span class="line"></span><br><span class="line">  @GetMapping(&quot;/request&quot;)</span><br><span class="line">  public void request() &#123;</span><br><span class="line">    Response response = reciveClient.recive();</span><br><span class="line">    System.out.println(response.headers());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class ReciveController &#123;</span><br><span class="line">  @GetMapping(&quot;/recive&quot;)</span><br><span class="line">  public String recive() &#123;</span><br><span class="line">    return &quot;hello world&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient</span><br><span class="line">public interface ReciveClient &#123;</span><br><span class="line">  @GetMapping(&quot;/recive&quot;)</span><br><span class="line">  public Response recive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://stackoverflow.com/questions/38742191/get-headers-feign-netflix" target="_blank" rel="noopener">https://stackoverflow.com/questions/38742191/get-headers-feign-netflix</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/05/feign/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/05/logback/">
                            Logback日志配置
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-05T16:52:54+08:00">
	
		    5月 05, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/logback/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/logback/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h3 id="Logback的主要模块"><a href="#Logback的主要模块" class="headerlink" title="Logback的主要模块"></a>Logback的主要模块</h3><h4 id="logback-access"><a href="#logback-access" class="headerlink" title="logback-access"></a>logback-access</h4><p>与server容器集成，提供通过http来访问日志的功能，我们的第三方软件可以通过logback-access来访问到logback里面记录的日志，例如kibanner等都会用到这个模块。</p>
<h4 id="logback-classic"><a href="#logback-classic" class="headerlink" title="logback-classic"></a>logback-classic</h4><p>log4j的改良版本，同时完整的实现了slef4j api，使你可以很方便的更换成其他的日志系统，比如log4j等。</p>
<h4 id="logback-core"><a href="#logback-core" class="headerlink" title="logback-core"></a>logback-core</h4><p>为我们前两个模块提供了基础的服务。</p>
<h3 id="Logback的主要标签"><a href="#Logback的主要标签" class="headerlink" title="Logback的主要标签"></a>Logback的主要标签</h3><h4 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h4><p>作为日志的记录器，主要用于存放日志对象，也可以定义日志的类型还有级别等。</p>
<h4 id="appender"><a href="#appender" class="headerlink" title="appender"></a>appender</h4><p>用于指定日志输出的目的地，可以是控制台、文件、远程套接字服务器等。</p>
<h4 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h4><p>用于格式化日志信息输出的。</p>
<h3 id="Logback的加载顺序"><a href="#Logback的加载顺序" class="headerlink" title="Logback的加载顺序"></a>Logback的加载顺序</h3><p>程序在运行的时候会按照一定的顺序去加载我们logback相关的配置文件</p>
<h4 id="1-如果我们在配置里面指定了logback-configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件"><a href="#1-如果我们在配置里面指定了logback-configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件" class="headerlink" title="1.如果我们在配置里面指定了logback.configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件"></a>1.如果我们在配置里面指定了logback.configurationFile这个属性那我们将使用这个属性的的地址去寻找相关的配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dlogback.configurationFile=xxxxxx/xxx.xml</span><br></pre></td></tr></table></figure>
<h4 id="2-如果没有配置这个属性他将会加载我们classpath下的logback-groovy文件"><a href="#2-如果没有配置这个属性他将会加载我们classpath下的logback-groovy文件" class="headerlink" title="2.如果没有配置这个属性他将会加载我们classpath下的logback.groovy文件"></a>2.如果没有配置这个属性他将会加载我们classpath下的logback.groovy文件</h4><h4 id="3-如果也找不到这个文件，才会加载同级目录下的logback-test-xml文件"><a href="#3-如果也找不到这个文件，才会加载同级目录下的logback-test-xml文件" class="headerlink" title="3.如果也找不到这个文件，才会加载同级目录下的logback-test.xml文件"></a>3.如果也找不到这个文件，才会加载同级目录下的logback-test.xml文件</h4><h4 id="4-如果也没有，它就会加载logback-xml文件"><a href="#4-如果也没有，它就会加载logback-xml文件" class="headerlink" title="4.如果也没有，它就会加载logback.xml文件"></a>4.如果也没有，它就会加载logback.xml文件</h4><h4 id="5-如果都没找到上述的配置文件，jdk1-6以上就会调用service-provider-loading-facility去查找com-qos-logback-classic-spi-Configurator这个接口的第一个实现类"><a href="#5-如果都没找到上述的配置文件，jdk1-6以上就会调用service-provider-loading-facility去查找com-qos-logback-classic-spi-Configurator这个接口的第一个实现类" class="headerlink" title="5.如果都没找到上述的配置文件，jdk1.6以上就会调用service-provider loading facility去查找com.qos.logback.classic.spi.Configurator这个接口的第一个实现类"></a>5.如果都没找到上述的配置文件，jdk1.6以上就会调用service-provider loading facility去查找com.qos.logback.classic.spi.Configurator这个接口的第一个实现类</h4><h4 id="6-如果上面的都没有，则会使用ch-qos-logback-classic-BasicConfigurator这个实现类，就是直接在控制台输出"><a href="#6-如果上面的都没有，则会使用ch-qos-logback-classic-BasicConfigurator这个实现类，就是直接在控制台输出" class="headerlink" title="6.如果上面的都没有，则会使用ch.qos.logback.classic.BasicConfigurator这个实现类，就是直接在控制台输出"></a>6.如果上面的都没有，则会使用ch.qos.logback.classic.BasicConfigurator这个实现类，就是直接在控制台输出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;!-- scan=&quot;true&quot; 如果配置文件被改变，将会重新去加载 --&gt;</span><br><span class="line">&lt;!-- scanPeriod 设置监测我们的配置文件是否有修改时间的时间间隔，默认单位是毫秒，当scan为true时生效，每分钟扫一下配置文件看有没有发生变化如果有变化就会重新去加载配置，这样就不需要重启服务器 --&gt;</span><br><span class="line">&lt;!-- debug 打印出logback的内部信息 实时查看logback的运行状态 --&gt;</span><br><span class="line">&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot; debug=&quot;false&quot;&gt;</span><br><span class="line">	&lt;!-- 定义参数常量 --&gt;</span><br><span class="line">	&lt;!-- TRACE&lt;DEBUG&lt;INFO&lt;WARN&lt;ERROR &gt;以上的级别才会显示--&gt;</span><br><span class="line">	&lt;property name=&quot;log.level&quot; value=&quot;debug&quot; /&gt;</span><br><span class="line">	&lt;!-- 文件保留的时长 --&gt;</span><br><span class="line">	&lt;property name=&quot;log.maxHistory&quot; value=&quot;30&quot; /&gt;</span><br><span class="line">	&lt;!-- 日志存储的根路径 --&gt;</span><br><span class="line">	&lt;property name=&quot;log.filePath&quot; value=&quot;$&#123;catalina.base&#125;/logs/webapps&quot; /&gt;</span><br><span class="line">	&lt;!-- 日志展示的格式 --&gt;</span><br><span class="line">	&lt;property name=&quot;log.pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; -</span><br><span class="line">		%msg%n&quot; /&gt;</span><br><span class="line">	&lt;!-- 控制台设置 --&gt;</span><br><span class="line">	&lt;appender name=&quot;consoleAppender&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">		&lt;!-- 将一个event事件转化为一组byte数组，还会将转化后的数据输出到文件中 --&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- DEBUG --&gt;</span><br><span class="line">	&lt;!-- 随着大小或时间滚动日志 --&gt;</span><br><span class="line">	&lt;appender name=&quot;debugAppender&quot; class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">		&lt;!-- 文件路径 --&gt;</span><br><span class="line">		&lt;file&gt;$&#123;log.filePath&#125;/debug.log&lt;/file&gt;</span><br><span class="line">		&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">			&lt;!-- 文件名称 --&gt;</span><br><span class="line">			&lt;fileNamePattern&gt;$&#123;log.filePath&#125;/debug/debug.%d&#123;yyyy-MM-dd&#125;.%i.log.gz&lt;/fileNamePattern&gt;</span><br><span class="line">			&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">			&lt;maxHistory&gt;$&#123;log.maxHistory&#125;&lt;/maxHistory&gt;</span><br><span class="line">		&lt;/rollingPolicy&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">		&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">			&lt;level&gt;DEBUG&lt;/level&gt;</span><br><span class="line">			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">		&lt;/filter&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- INFO --&gt;</span><br><span class="line">	&lt;appender name=&quot;infoAppender&quot; class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">		&lt;!-- 文件路径 --&gt;</span><br><span class="line">		&lt;file&gt;$&#123;log.filePath&#125;/info.log&lt;/file&gt;</span><br><span class="line">		&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">			&lt;!-- 文件名称 --&gt;</span><br><span class="line">			&lt;fileNamePattern&gt;$&#123;log.filePath&#125;/info/info.%d&#123;yyyy-MM-dd&#125;.%i.log.gz&lt;/fileNamePattern&gt;</span><br><span class="line">			&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">			&lt;maxHistory&gt;$&#123;log.maxHistory&#125;&lt;/maxHistory&gt;</span><br><span class="line">		&lt;/rollingPolicy&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">		&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">			&lt;level&gt;INFO&lt;/level&gt;</span><br><span class="line">			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">		&lt;/filter&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- ERROR --&gt;</span><br><span class="line">	&lt;appender name=&quot;errorAppender&quot; class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">		&lt;!-- 文件路径 --&gt;</span><br><span class="line">		&lt;file&gt;$&#123;log.filePath&#125;/error.log&lt;/file&gt;</span><br><span class="line">		&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">			&lt;!-- 文件名称 --&gt;</span><br><span class="line">			&lt;fileNamePattern&gt;$&#123;log.filePath&#125;/error/error.%d&#123;yyyy-MM-dd&#125;.%i.log.gz&lt;/fileNamePattern&gt;</span><br><span class="line">			&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">			&lt;maxHistory&gt;$&#123;log.maxHistory&#125;&lt;/maxHistory&gt;</span><br><span class="line">		&lt;/rollingPolicy&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;log.pattern&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">		&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="line">			&lt;level&gt;ERROR&lt;/level&gt;</span><br><span class="line">			&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span><br><span class="line">			&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="line">		&lt;/filter&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	&lt;!-- logger 存放日志对象，同时告诉我们logback我们需要关注哪个package下的信息 --&gt;</span><br><span class="line">	&lt;!-- additivity 如果additivity为true那么root下面的appender也会想到logger下面 --&gt;</span><br><span class="line">	&lt;logger name=&quot;com.brotherc.demo&quot; level=&quot;$&#123;log.level&#125;&quot; additivity=&quot;true&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;debugAppender&quot; /&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;infoAppender&quot; /&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;errorAppender&quot; /&gt;</span><br><span class="line">	&lt;/logger&gt;</span><br><span class="line">	&lt;!--root 就是特殊的logger，根logger。如果logger没有指定level，默认继承root --&gt;</span><br><span class="line">	&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;consoleAppender&quot; /&gt;</span><br><span class="line">	&lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/05/logback/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/05/04/分布式事务/">
                            分布式事务
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-04T19:43:32+08:00">
	
		    5月 04, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h5 id="两段式：2PC"><a href="#两段式：2PC" class="headerlink" title="两段式：2PC"></a>两段式：2PC</h5><h5 id="三段式：3PC"><a href="#三段式：3PC" class="headerlink" title="三段式：3PC"></a>三段式：3PC</h5><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/分布式事务/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/分布式事务/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h5 id="1-需要提供分布式事务支持的接口上添加-Compensable"><a href="#1-需要提供分布式事务支持的接口上添加-Compensable" class="headerlink" title="1.需要提供分布式事务支持的接口上添加@Compensable"></a>1.需要提供分布式事务支持的接口上添加@Compensable</h5><h5 id="2-在对应的接口实现上添加-Compensable"><a href="#2-在对应的接口实现上添加-Compensable" class="headerlink" title="2.在对应的接口实现上添加@Compensable"></a>2.在对应的接口实现上添加@Compensable</h5><h5 id="3-在接口上添加confirmMethod、cancelMethod、transactionContextEditor"><a href="#3-在接口上添加confirmMethod、cancelMethod、transactionContextEditor" class="headerlink" title="3.在接口上添加confirmMethod、cancelMethod、transactionContextEditor"></a>3.在接口上添加confirmMethod、cancelMethod、transactionContextEditor</h5><h5 id="4-实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）"><a href="#4-实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）" class="headerlink" title="4.实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）"></a>4.实现对应的confirmMethod、cancelMethod（注意：confirm方法和cancel方法必须与try方法在同一个类中）</h5><h5 id="5-主事务的业务都已经实现的差不多的时候才调用子事务"><a href="#5-主事务的业务都已经实现的差不多的时候才调用子事务" class="headerlink" title="5.主事务的业务都已经实现的差不多的时候才调用子事务"></a>5.主事务的业务都已经实现的差不多的时候才调用子事务</h5><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><h5 id="1-分布式事务里，不要轻易在业务层捕获所有异常"><a href="#1-分布式事务里，不要轻易在业务层捕获所有异常" class="headerlink" title="1.分布式事务里，不要轻易在业务层捕获所有异常"></a>1.分布式事务里，不要轻易在业务层捕获所有异常</h5><h5 id="2-使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持"><a href="#2-使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持" class="headerlink" title="2.使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持"></a>2.使用TCC-Transaction时，confirm和cancel的幂等性需要自己代码支持</h5><h5 id="幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同"><a href="#幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同" class="headerlink" title="幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同"></a>幂等性：使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同</h5><p>参考：<br><a href="https://github.com/changmingxie/tcc-transaction" target="_blank" rel="noopener">https://github.com/changmingxie/tcc-transaction</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/05/04/分布式事务/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/04/18/加密类型及其相关算法/">
                            加密类型及其相关算法
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-04-18T14:50:24+08:00">
	
		    4月 18, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="一、数据传输安全性"><a href="#一、数据传输安全性" class="headerlink" title="一、数据传输安全性"></a>一、数据传输安全性</h2><h5 id="在TCP-IP层中不涉及安全"><a href="#在TCP-IP层中不涉及安全" class="headerlink" title="在TCP/IP层中不涉及安全"></a>在TCP/IP层中不涉及安全</h5><ul>
<li>机密性：明文传输（ftp,smtp,talnet）别人一拦截就能看到请求的内容。</li>
<li>完整性：10颗原子弹（被改成100）所以数据在互联网上传播的时候，不应该也不能够被其他人非法篡改掉。当收到的和发送的不一致时拒绝接受这就能保证数据的完整性。</li>
<li>身份验证：通过有效的手段保证所访问的对象就是我们所要的那个人。</li>
</ul>
<h4 id="保证数据的机密性"><a href="#保证数据的机密性" class="headerlink" title="保证数据的机密性"></a>保证数据的机密性</h4><ul>
<li>plaintext(明文) –&gt; 加密（转换规则）–&gt; ciphertext（密文）</li>
<li>ciphertext –&gt; 转换规则 –&gt; plaintext</li>
<li>转换算法：依赖密钥（即使得到了转换规则也没用）</li>
<li>对称加密：加密和解密使用同一个密钥（有加密算法和解密算法，算法不同，但密钥相同）。<br>好处是计算速度快，在一定程度上解决了机密性问题。坏处是不能解决密钥有效管理的问题。<br>假如a跟b，c,d通信，如果密钥相同，则c只要用密钥就可以看到a发送给b的内容，显然密钥不能相同，<br>那就得维护很多密钥。</li>
</ul>
<h4 id="保证数据的完整性"><a href="#保证数据的完整性" class="headerlink" title="保证数据的完整性"></a>保证数据的完整性</h4><ul>
<li>A：plaintext:footprint –&gt; B<br>B使用同样的加密算法去重复计算这个明文的特征码，并跟A所发过来的特征码进行比较，<br>如果一样，则说明没被篡改。</li>
<li>单项加密算法：提取数据特征码，追加到数据后面。数据的输入一样：特征码必然相同。</li>
<li>特点：<br>输入一样，输出必然相同<br>雪崩效应（输入的微小改变，将其会引起结果的巨大改变）<br>定长输出（无论原始数据是多长，结果大小都是相同的）<br>不可逆（无法根据原始特征码还原原来的数据）</li>
</ul>
<h4 id="中间人攻击问题"><a href="#中间人攻击问题" class="headerlink" title="中间人攻击问题"></a>中间人攻击问题</h4><ul>
<li>E(A)：plaintext2:footprint2 –&gt; B<br>A生成一段数据，并对它计算特征码，E在中间经过的路由时拿到这个明文，并重新修改明文和再计算特征码发给B，还声称自己是A，B拿到数据之后就算使用了数据完整性的算法之后，计算特征码还是一模一样，还认为是A发过来的，所以需要借助额外的机制。</li>
<li>解决办法：A：plaintext:footprint(加密) –&gt; B B拿到特征码之后通过密钥进行解密，能解密<br>说明数据没有被改过。如果E拿到plaintext并修改为plaintext2，并重新生成特征码，就没办法加密<br>特征码或者加密后就不是A和B之间实现约定的密码。</li>
</ul>
<h4 id="A与B之间如何进行密码约定"><a href="#A与B之间如何进行密码约定" class="headerlink" title="A与B之间如何进行密码约定"></a>A与B之间如何进行密码约定</h4><ul>
<li>假如A与B之间从未通信或从未见过面，如何进行密码约定呢？</li>
<li>协商生成密码：密码交换（Internet Key Exchange / IKE）,密码交换是不让第三方得到密钥，<br>密码交换需要特殊的互联网协议支撑。比如：Dffie-Hellman协议。</li>
<li>A和B事先约定两个数p(大素数)，g(生成数)。A生成一个自己知道的x，B生成一个自己知道的y。<br>A将 g^x % p 发送给B，B将g^y % p 发送给A。<br>A拿到之后进行计算 （g^y % p）^x = g^xy % p，<br>B拿到之后进行计算 （g^x % p）^y = g^xy % p。<br>这个相同的结果就是密钥。<br>在互联网上可以看到g、p、g^x % p、g^y % p，但看不到x、y。</li>
<li>A和B只需要选好几个数，让这些数的计算结果作为密钥来用，使得彼此不用计算密码，只要双方<br>生成密钥的软件一样就可以随时生成密钥。</li>
</ul>
<h4 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h4><ul>
<li>之前是A和B一起约定好的密码，所以身份验证没问题。但是密钥是交换生成的，事先之前谁也不知道。<br>E跳出来，截取了数据并篡改，然后与B进行连接通信，还告诉它自己是A。</li>
<li>解决办法：公钥加密算法（非对称加密算法）</li>
<li>特点：拥有一对密钥对，分别是公钥（是从私钥中提取出来的）、私钥。用公钥加密的，只能用私钥<br>解密，反之亦然。</li>
</ul>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><ul>
<li>机密性：用B的公钥加密，B的私钥解密。发送方用对方的公钥加密数据，可以保证数据机密性。</li>
<li>身份验证：用A的私钥加密，A的公钥解密。发送方用自己的私钥加密数据，可以实现身份验证。</li>
<li>公钥加密算法很少用来加密数据：速度太慢。非对称加密的主要作用也就是身份验证。</li>
</ul>
<h2 id="二、数据传输"><a href="#二、数据传输" class="headerlink" title="二、数据传输"></a>二、数据传输</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/数据传输.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/数据传输.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>PKI:公钥基础设施(Public Key Infrastructure) 核心就是CA和彼此之间的信任关系<br>CA:证书颁发机构(Certificate Authority)，CA中还维护了CRL<br>CRL:证书撤销列表，CRL中保存了此前曾经发出去的证书，但仍未过期，只不过已经各种原因被撤销了</p>
<h2 id="三、TLS-SSL"><a href="#三、TLS-SSL" class="headerlink" title="三、TLS/SSL"></a>三、TLS/SSL</h2><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h3 id="不同标准下的证书格式是不同的"><a href="#不同标准下的证书格式是不同的" class="headerlink" title="不同标准下的证书格式是不同的"></a>不同标准下的证书格式是不同的</h3><p>比如x509, pkcs12<br>x509: 公钥及其有效期限，证书的合法拥有者，证书该如何被使用，CA的信息，CA签名的校验码<br>TLS/SSL所使用的正是x509的证书，TLS/SSL其实就是一种PKI，PKI的第二种实现OpenGPG</p>
<h3 id="TLS-SSL-如何实现握手认证、密钥交换"><a href="#TLS-SSL-如何实现握手认证、密钥交换" class="headerlink" title="TLS/SSL 如何实现握手认证、密钥交换"></a>TLS/SSL 如何实现握手认证、密钥交换</h3><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/加密/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/加密/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h2 id="四、加密"><a href="#四、加密" class="headerlink" title="四、加密"></a>四、加密</h2><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>加密解密使用同一个密码</p>
<ul>
<li>DES(Data Encrption Standard, 56bit)</li>
<li>3DES</li>
<li>AES(Advanced, AES192/AES256/AES512)</li>
<li>Blowfish</li>
</ul>
<h3 id="单向加密"><a href="#单向加密" class="headerlink" title="单向加密"></a>单向加密</h3><ul>
<li>MD4</li>
<li>MD5</li>
<li>SHA1</li>
<li>SHA192、SHA256、SHA384</li>
<li>CRC-32</li>
</ul>
<h3 id="非对称加密（公钥加密）"><a href="#非对称加密（公钥加密）" class="headerlink" title="非对称加密（公钥加密）"></a>非对称加密（公钥加密）</h3><p>身份认证（数字签名）、数据加密、密钥交换</p>
<ul>
<li>RSA(加密、签名)</li>
<li>DSA(签名)</li>
<li>ElGamal</li>
</ul>
<h3 id="加密实现"><a href="#加密实现" class="headerlink" title="加密实现"></a>加密实现</h3><p>OpenSSL: SSL的开源实现<br>  libcryptc: 通用的加密库<br>  libssl: TLS/SSL的实现<br>    基于会话的、实现了省份认证、数据机密性和会话完整性的TLS/SSL库<br>  openssl: 多用途命令行工具<br>    实现私有证书颁发机构</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/04/18/加密类型及其相关算法/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/04/12/docker/">
                            docker基础
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-04-12T12:05:46+08:00">
	
		    4月 12, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/1.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/1.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/2.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/2.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/3.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/3.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/4.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/4.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/5.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/5.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/6.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/6.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/7.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/7.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/8.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/8.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/9.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/9.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/10.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/10.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/11.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/11.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/12.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/12.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/13.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/13.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/14.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/14.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/15.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/15.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/16.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/16.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/17.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/17.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/18.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/18.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/19.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/19.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/20.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/20.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/21.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/21.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">docker-common \</span><br><span class="line">docker-selinux \</span><br><span class="line">docker-engine</span><br><span class="line"></span><br><span class="line">sudo yum install -y yum-utils \</span><br><span class="line">device-mapper-persistent-data \</span><br><span class="line">lvm2</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo docker version</span><br></pre></td></tr></table></figure>
<h3 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h3 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h3><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/22.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/22.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/23.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/23.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/24.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/24.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 查看进程</span><br><span class="line">ps -ef | grep docker</span><br><span class="line">// 查看镜像</span><br><span class="line">sudo docker image ls</span><br><span class="line">// 拉取镜像</span><br><span class="line">sudo docker pull ubuntu:14.04</span><br><span class="line">// 运行镜像</span><br><span class="line">docker run hello-world</span><br><span class="line">docker run -it centos</span><br><span class="line">// 删除镜像</span><br><span class="line">docker image rm 67759a80360c(镜像ID)</span><br><span class="line">docker image rmi f2a91732366c(镜像ID)</span><br></pre></td></tr></table></figure>
<h3 id="自己实现helloworld"><a href="#自己实现helloworld" class="headerlink" title="自己实现helloworld"></a>自己实现helloworld</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir hello-world</span><br><span class="line">cd hello-world/</span><br><span class="line">vim hello.c</span><br><span class="line"></span><br><span class="line">// 内容</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">  printf(&quot;hello docker\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gcc -static hello.c -o hello</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line">// 内容</span><br><span class="line">FROM scratch</span><br><span class="line">ADD hello /</span><br><span class="line">CMD [&quot;/hello&quot;]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t brotherc/hello-world .</span><br><span class="line">docker run brotherc/hello-world</span><br></pre></td></tr></table></figure>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/25.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/25.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker container ls</span><br><span class="line">docker container ls -a</span><br><span class="line">docker container ps -a</span><br><span class="line">docker rm $(docker container ls -f &quot;status-exited&quot; -q)</span><br><span class="line">docker rm $(docker container ls -aq)</span><br><span class="line">docker container rm 846b5efe98d4(容器ID)</span><br><span class="line">docker container rm 84(容器ID前缀)</span><br><span class="line">// 将已有容器提交成新的镜像</span><br><span class="line">Usage: docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] [flags]</span><br><span class="line">docker commit xenodochial_pare(容器名称) brotherc/centos-vim</span><br><span class="line">docker stop 容器id或名称</span><br><span class="line">docker start 容器id或名称</span><br><span class="line">docker inspect 容器id或名称</span><br><span class="line">docker logs 容器id或名称</span><br></pre></td></tr></table></figure>
<h3 id="基于已经存在的container创建一个image"><a href="#基于已经存在的container创建一个image" class="headerlink" title="基于已经存在的container创建一个image"></a>基于已经存在的container创建一个image</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 运行一个已安装好vim的centos容器</span><br><span class="line">docker run -it centos</span><br><span class="line">yum install -y vim</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 容器名：xenodochial_pare</span><br><span class="line">docker commit xenodochial_pare brotherc/centos-vim</span><br></pre></td></tr></table></figure>
<h3 id="基于Dockerfile创建一个image"><a href="#基于Dockerfile创建一个image" class="headerlink" title="基于Dockerfile创建一个image"></a>基于Dockerfile创建一个image</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir docker-centos-vim</span><br><span class="line">cd docker-centos-vim/</span><br><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">RUN yum install -y vim</span><br><span class="line"></span><br><span class="line">docker build -t brotherc/centos-vim-new .</span><br></pre></td></tr></table></figure>
<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>尽量使用官方的image作为base image!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM scratch #制作base image</span><br><span class="line">FROM centos  #使用base image</span><br><span class="line">FROM ubuntu:14.04</span><br></pre></td></tr></table></figure></p>
<h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h4><p>Metadata不可少!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LABEL maintainer=&quot;brotherc@136.com&quot;</span><br><span class="line">LABEL version=&quot;1.0&quot;</span><br><span class="line">LABEL description=&quot;This is description&quot;</span><br></pre></td></tr></table></figure></p>
<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>为了美观，复杂的RUN请用反斜杠换行!避免无用分层，合并多条命令成一行!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN yum update &amp;&amp; yum install -y vim \ #反斜线换行</span><br><span class="line">    python-dev</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get update &amp;&amp; apt-get install -y perl \</span><br><span class="line">    pwgen --no-install-recommends &amp;&amp; rm -rf \</span><br><span class="line">    /var/lib/apt/lists/* #注意清理cache</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN /bin/bash -c&apos;source $HOME/.bashrc;echo $HOME&apos;</span><br></pre></td></tr></table></figure>
<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>设定当前工作目录，类似cd<br>用WORKDIR，不要用RUN cd!尽量使用绝对目录!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /root</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /test #如果没有会自动创建test目录</span><br><span class="line">WORKDIR demo</span><br><span class="line">RUN pwd       #输出结果应该是 /test/demo</span><br></pre></td></tr></table></figure>
<h4 id="ADD-and-COPY"><a href="#ADD-and-COPY" class="headerlink" title="ADD and COPY"></a>ADD and COPY</h4><p>将本地文件添加到image里面<br>大部分情况，COPY优于ADD!ADD除了COPY还有额外功能(解压)!添加远程文件/目录<br>请使用curl或者wget!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD hello /</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD test.tar.gz / #添加到根目录并解压</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /root</span><br><span class="line">ADD hello test/ # /root/test/hello</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /root</span><br><span class="line">COPY hello test/</span><br></pre></td></tr></table></figure>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>尽量使用ENV增加可维护性!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV MYSQL_VERSION 5.6 #设置常量</span><br><span class="line">RUN apt-get install -y mysql-server=&quot;$&#123;MYSQL_VERSION&#125;&quot; \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/* #引用常量</span><br></pre></td></tr></table></figure></p>
<h4 id="RUN-vs-CMD-vs-ENTRYPOINT"><a href="#RUN-vs-CMD-vs-ENTRYPOINT" class="headerlink" title="RUN vs CMD vs ENTRYPOINT"></a>RUN vs CMD vs ENTRYPOINT</h4><p>RUN:执行命令并创建新的image layer<br>CMD:设置容器启动后默认执行的命令和参数<br>ENTRYPOINT:设置容器启动时运行的命令</p>
<h4 id="Shell格式"><a href="#Shell格式" class="headerlink" title="Shell格式"></a>Shell格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get install -y vim</span><br><span class="line">CMD echo &quot;hello docker&quot;</span><br><span class="line">ENTRYPOINT echo &quot;hello docker&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT echo &quot;hello $name&quot;</span><br></pre></td></tr></table></figure>
<h4 id="Exec格式"><a href="#Exec格式" class="headerlink" title="Exec格式"></a>Exec格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN [&quot;apt-get&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;vim&quot;]</span><br><span class="line">CMD [&quot;/bin/echo&quot;, &quot;hello docker&quot;]</span><br><span class="line">ENTRYPOINT [&quot;/bin/echo&quot;, &quot;hello docker&quot;]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT [&quot;/bin/echo&quot;, &quot;hello docker&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="Dockerfile实践"><a href="#Dockerfile实践" class="headerlink" title="Dockerfile实践"></a>Dockerfile实践</h3><p>Dockerfile:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT echo &quot;hello $name&quot;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t brotherc/centos-entrypoint-shell .</span><br><span class="line">docker run brotherc/centos-entrypoint-shell</span><br><span class="line">hello Docker</span><br></pre></td></tr></table></figure>
<p>Dockerfile:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo hello $name&quot;]</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t brotherc/centos-entrypoint-exec .</span><br><span class="line">docker run brotherc/centos-entrypoint-exec</span><br><span class="line">hello Docker</span><br></pre></td></tr></table></figure>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>容器启动时默认执行的命令<br>如果docker run指定了其它命令，CMD命令被忽略<br>如果定义了多个CMD，只有最后一个会执行<br>Dockerfile:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">CMD echo &quot;hello $name&quot;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker build -t brotherc/centos-cmd-shell .</span><br><span class="line">docker run brotherc/centos-cmd-shell</span><br><span class="line">hello Docker</span><br><span class="line"></span><br><span class="line">docker run -it brotherc/centos-cmd-shell /bin/bash</span><br><span class="line">无输出</span><br></pre></td></tr></table></figure>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>让容器以应用程序或者服务的形式运行<br>不会被忽略，一定会执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run brotherc/centos-entrypoint-shell</span><br><span class="line">hello Docker</span><br><span class="line"></span><br><span class="line">docker run -it brotherc/centos-entrypoint-shell /bin/bash</span><br><span class="line">hello Docker</span><br></pre></td></tr></table></figure></p>
<h3 id="镜像的发布"><a href="#镜像的发布" class="headerlink" title="镜像的发布"></a>镜像的发布</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br><span class="line">docker push DockerId/镜像名称</span><br><span class="line">docker pull DockerId/镜像名称</span><br></pre></td></tr></table></figure>
<h4 id="分享产生image"><a href="#分享产生image" class="headerlink" title="分享产生image"></a>分享产生image</h4><p>把我们的账户link到github或bitbucket，在github上面创建一个代码仓库，把我们的dockerfile push上去，这样就做了一个关联。<br>只要我们这个仓库里面有dockerfile，就会自动去克隆获取到这个dockerfile然后dockerhub后台服务器会帮我们去build。<br>这样我们既提供了dockerfile，docker image又是dockerhub后台服务器帮我们build的，这个安全性会有很大的提升。<br><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/78.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/78.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div></p>
<h4 id="私有的registry"><a href="#私有的registry" class="headerlink" title="私有的registry"></a>私有的registry</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart always --name registry</span><br><span class="line">// 访问ip:5000</span><br></pre></td></tr></table></figure>
<p>/etc/docker/daemon.json:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;insecure-registries&quot;:[&quot;ip:5000&quot;]&#125;</span><br></pre></td></tr></table></figure></p>
<p>/lib/systemd/system/docker.service:<br><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/79.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/79.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">telnet ip:5000</span><br><span class="line"></span><br><span class="line">docker push ip:5000/镜像名称</span><br><span class="line">docker pull ip:5000/镜像名称</span><br></pre></td></tr></table></figure>
<h3 id="Docker-Network"><a href="#Docker-Network" class="headerlink" title="Docker Network"></a>Docker Network</h3><h4 id="基础网络概念"><a href="#基础网络概念" class="headerlink" title="基础网络概念"></a>基础网络概念</h4><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/32.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/32.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/33.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/33.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/34.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/34.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/35.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/35.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/36.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/36.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/37.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/37.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/38.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/38.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/39.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/39.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/40.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/40.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test1 busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line">sudo docker exec -it test1 /bin/sh</span><br><span class="line"></span><br><span class="line">ip a</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test2 busybox /bin/sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line">sudo docker exec test2 ip a</span><br></pre></td></tr></table></figure>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/41.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/41.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/42.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/42.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/43.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/43.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/44.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/44.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/45.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/45.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/46.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/46.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/47.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/47.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/48.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/48.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/49.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/49.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/50.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/50.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/51.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/51.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/52.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/52.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/53.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/53.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/54.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/54.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/55.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/55.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/56.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/56.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/57.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/57.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/58.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/58.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/59.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/59.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/60.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/60.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/61.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/61.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/62.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/62.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/63.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/63.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/64.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/64.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/65.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/65.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/66.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/66.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/67.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/67.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/68.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/68.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/69.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/69.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/70.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/70.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/71.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/71.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/72.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/72.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/73.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/73.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/74.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/74.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/75.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/75.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/76.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/76.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/77.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/77.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h3 id="Docker的持久化存储和数据共享"><a href="#Docker的持久化存储和数据共享" class="headerlink" title="Docker的持久化存储和数据共享"></a>Docker的持久化存储和数据共享</h3><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/26.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/26.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/27.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/27.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/28.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/28.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/29.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/29.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<h4 id="数据持久化：Data-Volume"><a href="#数据持久化：Data-Volume" class="headerlink" title="数据持久化：Data Volume"></a>数据持久化：Data Volume</h4><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/30.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/30.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//mysql镜像会默认将数据挂载到本地</span><br><span class="line">sudo docker run -d --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker volume ls</span><br><span class="line"></span><br><span class="line">DRIVER        VOLUME NAME</span><br><span class="line">local         e6ee5901156...</span><br><span class="line"></span><br><span class="line">sudo docker volume inspect e6ee5901156...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stop mysql1</span><br><span class="line">sudo docker rm mysql1</span><br><span class="line">sudo docker volume ls</span><br><span class="line"></span><br><span class="line">DRIVER        VOLUME NAME</span><br><span class="line">local         e6ee5901156...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//给volume指定名字</span><br><span class="line">sudo docker run -d -v mysql:/var/lib/mysql --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</span><br><span class="line">sudo docker volume ls</span><br><span class="line"></span><br><span class="line">DRIVER        VOLUME NAME</span><br><span class="line">local         mysql</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//让mysql容器使用已存在的volume</span><br><span class="line">sudo docker rm -rf mysql1</span><br><span class="line">sudo docker run -d -v mysql:/var/lib/mysql --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</span><br></pre></td></tr></table></figure>
<h4 id="数据持久化：Bind-Mouting"><a href="#数据持久化：Bind-Mouting" class="headerlink" title="数据持久化：Bind Mouting"></a>数据持久化：Bind Mouting</h4><div class="figure center" style="width:100%;"><a class="fancybox" href="/assets/docker/31.jpg" title="" data-caption="" data-fancybox="travel"><img class="fig-img" src="/assets/docker/31.jpg" style="width:100%;height:100%;" alt=""></a></div><div style="clear:both;"></div>
<p>Dockerfile:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx:latest</span><br><span class="line">WORKDIR /usr/share/nginx/html</span><br><span class="line">COPY index.html index.html</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t brotherc/my-nginx .</span><br><span class="line">docker run -d -p 80:80 --name web brotherc/my-nginx</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f web</span><br><span class="line">docker run -d -v $(pwd):/usr/share/nginx/html -p 80:80 --name web brotherc/my-nginx</span><br><span class="line">docker exec -it web /bin/bash</span><br><span class="line">//在容器中</span><br><span class="line">cd /usr/share/nginx/html</span><br><span class="line">touch test.txt</span><br><span class="line">exit</span><br><span class="line">//在linux中看到刚刚创建的test.txt文件</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/04/12/docker/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2020/04/09/网站/">
                            网站
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-04-09T20:46:59+08:00">
	
		    4月 09, 2020
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>参考：<br><a href="https://www.wireshark.org" target="_blank" rel="noopener">https://www.wireshark.org</a><br><a href="https://www.processon.com/" target="_blank" rel="noopener">https://www.processon.com/</a></p>
<p><a href="http://xinjipin.com/list.asp?id=26" target="_blank" rel="noopener">http://xinjipin.com/list.asp?id=26</a><br><a href="https://www.yunpanjingling.com/" target="_blank" rel="noopener">https://www.yunpanjingling.com/</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2020/04/09/网站/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/2020/page/2/">
              <span>下一页</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 1 页 共 5 页</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Brotherc. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/head.jpg" alt="作者的图片">
        
            <h4 id="about-card-name">Brotherc</h4>
        
            <div id="about-card-bio"><p>java development</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>java</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                zhuhai
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
