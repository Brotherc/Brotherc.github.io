<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL-性能优化 | Brotherc 博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="博客">
    
    <link rel="preload" href="/assets/css/0.styles.fc7355b1.css" as="style"><link rel="preload" href="/assets/js/app.99990956.js" as="script"><link rel="preload" href="/assets/js/15.0cf965fc.js" as="script"><link rel="preload" href="/assets/js/1.f6a8d0e9.js" as="script"><link rel="preload" href="/assets/js/8.f65b31ef.js" as="script"><link rel="prefetch" href="/assets/js/10.a94e2ddc.js"><link rel="prefetch" href="/assets/js/100.4a4f0b40.js"><link rel="prefetch" href="/assets/js/101.224b6cc0.js"><link rel="prefetch" href="/assets/js/102.07e5eb96.js"><link rel="prefetch" href="/assets/js/103.d9e5a09d.js"><link rel="prefetch" href="/assets/js/104.b1a5b717.js"><link rel="prefetch" href="/assets/js/105.bde555d5.js"><link rel="prefetch" href="/assets/js/11.dcbdb25b.js"><link rel="prefetch" href="/assets/js/12.d6d0d401.js"><link rel="prefetch" href="/assets/js/13.aecb393d.js"><link rel="prefetch" href="/assets/js/14.0a717091.js"><link rel="prefetch" href="/assets/js/16.322ac18a.js"><link rel="prefetch" href="/assets/js/17.8fd33809.js"><link rel="prefetch" href="/assets/js/18.b3e024f2.js"><link rel="prefetch" href="/assets/js/19.d104677d.js"><link rel="prefetch" href="/assets/js/20.a4dfd45c.js"><link rel="prefetch" href="/assets/js/21.aef7cf96.js"><link rel="prefetch" href="/assets/js/22.f7a1b943.js"><link rel="prefetch" href="/assets/js/23.5aa289fa.js"><link rel="prefetch" href="/assets/js/24.e518ed61.js"><link rel="prefetch" href="/assets/js/25.a04fc655.js"><link rel="prefetch" href="/assets/js/26.7036214c.js"><link rel="prefetch" href="/assets/js/27.a37e20bb.js"><link rel="prefetch" href="/assets/js/28.3f35bd5e.js"><link rel="prefetch" href="/assets/js/29.7e2c6bc0.js"><link rel="prefetch" href="/assets/js/3.f4834aac.js"><link rel="prefetch" href="/assets/js/30.5fc8539c.js"><link rel="prefetch" href="/assets/js/31.2c0eeaba.js"><link rel="prefetch" href="/assets/js/32.e4d1eb11.js"><link rel="prefetch" href="/assets/js/33.63665d4c.js"><link rel="prefetch" href="/assets/js/34.8b9adb20.js"><link rel="prefetch" href="/assets/js/35.e3934286.js"><link rel="prefetch" href="/assets/js/36.aa93bd3d.js"><link rel="prefetch" href="/assets/js/37.43c3d167.js"><link rel="prefetch" href="/assets/js/38.5e1dfdfb.js"><link rel="prefetch" href="/assets/js/39.78606489.js"><link rel="prefetch" href="/assets/js/4.14e81dd0.js"><link rel="prefetch" href="/assets/js/40.9dcb28f6.js"><link rel="prefetch" href="/assets/js/41.4b6bafce.js"><link rel="prefetch" href="/assets/js/42.a71a3d10.js"><link rel="prefetch" href="/assets/js/43.1c6eb398.js"><link rel="prefetch" href="/assets/js/44.216101cf.js"><link rel="prefetch" href="/assets/js/45.1de5baa7.js"><link rel="prefetch" href="/assets/js/46.f76ac28a.js"><link rel="prefetch" href="/assets/js/47.8e40b173.js"><link rel="prefetch" href="/assets/js/48.3f8f0a70.js"><link rel="prefetch" href="/assets/js/49.c3b5bd2e.js"><link rel="prefetch" href="/assets/js/5.7a3febe3.js"><link rel="prefetch" href="/assets/js/50.187baa1b.js"><link rel="prefetch" href="/assets/js/51.e8f114b9.js"><link rel="prefetch" href="/assets/js/52.57a68fdf.js"><link rel="prefetch" href="/assets/js/53.1430034b.js"><link rel="prefetch" href="/assets/js/54.ba58cd6f.js"><link rel="prefetch" href="/assets/js/55.ed708502.js"><link rel="prefetch" href="/assets/js/56.020f4c8b.js"><link rel="prefetch" href="/assets/js/57.ed7e6602.js"><link rel="prefetch" href="/assets/js/58.712e4985.js"><link rel="prefetch" href="/assets/js/59.9730a526.js"><link rel="prefetch" href="/assets/js/6.a3d01d29.js"><link rel="prefetch" href="/assets/js/60.39f45273.js"><link rel="prefetch" href="/assets/js/61.7c583db6.js"><link rel="prefetch" href="/assets/js/62.ec1afb96.js"><link rel="prefetch" href="/assets/js/63.f5011888.js"><link rel="prefetch" href="/assets/js/64.58f8ae4e.js"><link rel="prefetch" href="/assets/js/65.7f47b185.js"><link rel="prefetch" href="/assets/js/66.20a95751.js"><link rel="prefetch" href="/assets/js/67.4b7340ba.js"><link rel="prefetch" href="/assets/js/68.8140cb1c.js"><link rel="prefetch" href="/assets/js/69.56b89ccf.js"><link rel="prefetch" href="/assets/js/7.62b2949b.js"><link rel="prefetch" href="/assets/js/70.ee3e23c1.js"><link rel="prefetch" href="/assets/js/71.bbc2db7a.js"><link rel="prefetch" href="/assets/js/72.92d67cda.js"><link rel="prefetch" href="/assets/js/73.a4d16f01.js"><link rel="prefetch" href="/assets/js/74.1fbb6a34.js"><link rel="prefetch" href="/assets/js/75.e243ec30.js"><link rel="prefetch" href="/assets/js/76.4cbb7b48.js"><link rel="prefetch" href="/assets/js/77.cc6cba22.js"><link rel="prefetch" href="/assets/js/78.a6758f1a.js"><link rel="prefetch" href="/assets/js/79.2dcb5413.js"><link rel="prefetch" href="/assets/js/80.2ea50024.js"><link rel="prefetch" href="/assets/js/81.6b0c34b7.js"><link rel="prefetch" href="/assets/js/82.b914f328.js"><link rel="prefetch" href="/assets/js/83.556704e0.js"><link rel="prefetch" href="/assets/js/84.8a263344.js"><link rel="prefetch" href="/assets/js/85.3695ee15.js"><link rel="prefetch" href="/assets/js/86.a86fc4c9.js"><link rel="prefetch" href="/assets/js/87.8375e97a.js"><link rel="prefetch" href="/assets/js/88.fc396dfb.js"><link rel="prefetch" href="/assets/js/89.0df55327.js"><link rel="prefetch" href="/assets/js/9.200b1e9d.js"><link rel="prefetch" href="/assets/js/90.68366e90.js"><link rel="prefetch" href="/assets/js/91.f334739a.js"><link rel="prefetch" href="/assets/js/92.7eaddb95.js"><link rel="prefetch" href="/assets/js/93.f2d68d0f.js"><link rel="prefetch" href="/assets/js/94.711c1e40.js"><link rel="prefetch" href="/assets/js/95.257fd0e5.js"><link rel="prefetch" href="/assets/js/96.2a5e8c59.js"><link rel="prefetch" href="/assets/js/97.cebe0049.js"><link rel="prefetch" href="/assets/js/98.da64b906.js"><link rel="prefetch" href="/assets/js/99.bbd2ee42.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fc7355b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Brotherc 博客</h3> <p class="description" data-v-59e6cb88>博客</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Brotherc 博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tag/" class="nav-link"><i class="undefined"></i>
  标签云
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      我的
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/brotherc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>93</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>43</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/tag/" class="nav-link"><i class="undefined"></i>
  标签云
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      我的
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/brotherc" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/front/typescript" class="sidebar-heading clickable"><span>前端</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/backend/Golang" class="sidebar-heading clickable"><span>后端</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/database/Oracle" class="sidebar-heading clickable open"><span>数据库</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/document/database/Oracle.html" class="sidebar-link">Oracle</a></li><li><a href="/blog/document/database/Oracle_monitor_sql.html" class="sidebar-link">Oracle-monitorSql</a></li><li><a href="/blog/document/database/mysql-Master-slave-replication-read-write-separation.html" class="sidebar-link">MySQL-主从复制与读写分离</a></li><li><a href="/blog/document/database/mysql-performance-optimization.html" aria-current="page" class="active sidebar-link">MySQL-性能优化</a></li><li><a href="/blog/document/database/mysql-uninstall.html" class="sidebar-link">MySQL-卸载</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/mybatis/Mybatis" class="sidebar-heading clickable"><span>ORM</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/guava/Google-Guava-Common-operations" class="sidebar-heading clickable"><span>Java第三方库</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/pattern/Simple-factory" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/encryption&amp;decryption/JAVA-encryption&amp;decryption" class="sidebar-heading clickable"><span>加解密</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/log/logback" class="sidebar-heading clickable"><span>日志</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/linux/linux-Commonly-used-instructions" class="sidebar-heading clickable"><span>操作系统</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/spring/spring-Common-operations" class="sidebar-heading clickable"><span>spring</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/spring/SpringSecurity-start" class="sidebar-heading clickable"><span>认证授权</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/microservice/resttemplate" class="sidebar-heading clickable"><span>微服务</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/latency_fault_tolerance/hystrix1" class="sidebar-heading clickable"><span>限流熔断</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/traceroute/skywalking" class="sidebar-heading clickable"><span>链路追踪</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/distributed_transaction/distributed_transaction1" class="sidebar-heading clickable"><span>分布式事务</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/distributed_lock/distributed_lock" class="sidebar-heading clickable"><span>分布式锁</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/taskschedule/xxl-job" class="sidebar-heading clickable"><span>分布式任务调度</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/monitor/prometheus" class="sidebar-heading clickable"><span>监控</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/container/docker" class="sidebar-heading clickable"><span>容器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/business/At-the-sametime-allow-only-one-client-front-end-interface-to-operate" class="sidebar-heading clickable"><span>业务场景</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/prod/cpu_hight_issue" class="sidebar-heading clickable"><span>生产环境问题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/mooc/Concurrent-programming-with-high-concurrency-solution-1" class="sidebar-heading clickable"><span>慕课</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/frame/NeteasePublic-Nginx" class="sidebar-heading clickable"><span>专题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/editor/idea/idea-setting" class="sidebar-heading clickable"><span>编辑器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/document/other/website" class="sidebar-heading clickable"><span>其它</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>MySQL-性能优化</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">MySQL-性能优化</h1> <div data-v-8a445198><!----> <!----> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>MySQL</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="mysql进阶"><a href="#mysql进阶" class="header-anchor">#</a> Mysql进阶</h2> <h2 id="索引与表设计准则"><a href="#索引与表设计准则" class="header-anchor">#</a> 索引与表设计准则</h2> <h2 id="explain执行计划"><a href="#explain执行计划" class="header-anchor">#</a> Explain执行计划</h2> <h2 id="sql优化"><a href="#sql优化" class="header-anchor">#</a> SQL优化</h2> <h2 id="mysql中锁机制"><a href="#mysql中锁机制" class="header-anchor">#</a> Mysql中锁机制</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <ul><li>锁,在现实生活中是为我们想要隐藏于外界所使用的一种工具</li> <li>在计算机中,是协调多个进程或线程并发访问某一资源的一种机制</li> <li>在数据库当中,除了传统的计算资源(CPU, RAM, VO等等)的争用之外,数据也是一种供许多用户共享访问的资源</li> <li>如何保证数据并发访问的一致性、有效性,是所有数据库必须解决的一个问题</li> <li>锁的冲突也是影响数据库并发访问性能的一个重要因素</li></ul> <h3 id="举例"><a href="#举例" class="header-anchor">#</a> 举例</h3> <ul><li>在购买商品时,商品库存只有1个时,两个人同时买时,谁买到的问题</li> <li>会用到事务,先从库存表中取出物品的数据,然后插入订单,付款后,插入付款表信息</li> <li>更新商品的效量,在这个过程中,使用锁可以对有限的资源进行保护,解决隔意和并发的矛盾</li></ul> <h3 id="锁分类"><a href="#锁分类" class="header-anchor">#</a> 锁分类</h3> <p>按操作分：</p> <ul><li>读锁(共享锁)</li> <li>写锁(排它锁)</li></ul> <p>按粒度分：</p> <ul><li>表锁</li> <li>行锁</li> <li>页锁</li></ul> <h3 id="表锁"><a href="#表锁" class="header-anchor">#</a> 表锁</h3> <ul><li>偏向MYISAM存储引擎,开销小,加锁快,无死锁,锁定粒度大,发生锁冲突的概率最高,并发最低</li> <li>整张表就只能一个人使用</li></ul> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <p>1· 建立一张Myisam引擎的表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>locktest<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MyISAM <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>查看表有没有被锁过</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">open</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>对表加锁</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">lock</span> <span class="token keyword">table</span> locktest <span class="token keyword">read</span><span class="token punctuation">,</span> locktest2 <span class="token keyword">write</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="4"><li>对表进行解锁</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">unlock</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="读写锁对操作和性能产生哪些影响"><a href="#读写锁对操作和性能产生哪些影响" class="header-anchor">#</a> 读写锁对操作和性能产生哪些影响</h4> <ol><li>对locktest添加读锁 lock table locktest read;(共享)</li></ol> <table><thead><tr><th></th> <th>是否可以查看自己</th> <th>是否可以更新</th> <th>能不能读别的表</th></tr></thead> <tbody><tr><td>当前连接</td> <td>可以</td> <td>不可以</td> <td>不可以,当前表还没有解锁,不能放下当前,操作别的内容</td></tr> <tr><td>另一个连接</td> <td>可以</td> <td>当更新时,处理阻塞状态,等待解锁后,才能进行更新</td> <td>可以</td></tr></tbody></table> <ol start="2"><li>对locktest添加写锁 lock table locktest write;(排它)</li></ol> <table><thead><tr><th></th> <th>是否可以查看自己</th> <th>是否可以更新</th> <th>能不能读别的表</th></tr></thead> <tbody><tr><td>当前连接</td> <td>可以</td> <td>可以</td> <td>不可以</td></tr> <tr><td>另一个连接</td> <td>可以</td> <td>当更新时,处理阻塞状态,等待解锁后,才能进行更新</td> <td>可以</td></tr></tbody></table> <p><img src="/assets/img/1.cd3bcf5b.jpg" alt=""><br> <img src="/assets/img/2.08ce138f.jpg" alt=""> <img src="/assets/img/3.f4571210.jpg" alt=""> <img src="/assets/img/4.866e6720.jpg" alt=""> <img src="/assets/img/5.308e07ff.jpg" alt=""> <img src="/assets/img/6.b8cdf411.jpg" alt=""> <img src="/assets/img/7.48f0cabf.jpg" alt=""> <img src="/assets/img/8.2469591a.jpg" alt=""> <img src="/assets/img/9.07760815.jpg" alt=""> <img src="/assets/img/10.19d33d99.jpg" alt=""> <img src="/assets/img/11.f88d6571.jpg" alt=""> <img src="/assets/img/12.0eaf65d3.jpg" alt=""> <img src="/assets/img/13.892a08b0.jpg" alt=""> <img src="/assets/img/14.e052d381.jpg" alt=""> <img src="/assets/img/15.41ff1d64.jpg" alt=""> <img src="/assets/img/16.e9d92a3d.jpg" alt=""> <img src="/assets/img/17.32ae5f92.jpg" alt=""> <img src="/assets/img/18.dc2de73f.jpg" alt=""> <img src="/assets/img/19.4e0d7d7c.jpg" alt=""> <img src="/assets/img/20.633c0d61.jpg" alt=""> <img src="/assets/img/21.84c0139f.jpg" alt=""> <img src="/assets/img/22.4c0f9787.jpg" alt=""> <img src="/assets/img/23.bb9a35ae.jpg" alt=""> <img src="/assets/img/24.1862abea.jpg" alt=""> <img src="/assets/img/25.7279c3ae.jpg" alt=""> <img src="/assets/img/26.45dd16b2.jpg" alt=""> <img src="/assets/img/27.46962a2a.jpg" alt=""> <img src="/assets/img/28.2795affa.jpg" alt=""></p> <h4 id="表锁分析"><a href="#表锁分析" class="header-anchor">#</a> 表锁分析</h4> <ul><li>show status like 'table%';</li> <li>Myisam的读写锁调度是写优先,这也是myisam不适合做写为主表的引擎</li> <li>因为写锁后,其它线程不能做任何操作,大量更新会使用查询很难得到锁,从而造成永久阻塞</li> <li>淘宝：买家库(偏向读取)、卖家库(卖家库更多偏向写)</li></ul> <h3 id="行锁"><a href="#行锁" class="header-anchor">#</a> 行锁</h3> <ul><li>偏向InnoDB存储引擎,开销大,加锁慢,会出现死锁,锁定粒度小,发生冲突的概率最低,并发度也最高</li> <li>InnoDB与MyISAM的最大不同点:一是支持事务,二是采用了行级锁</li></ul> <h4 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h4> <ul><li>ACID属性</li></ul> <table><thead><tr><th>属性</th> <th></th></tr></thead> <tbody><tr><td>原子性(Atomicity)</td> <td>原子性是指事务包含的所有操作要么全部成功,要么全部失败回滚</td></tr> <tr><td>一致性(Consistency)</td> <td>一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态,也就是说一个事务执行之前和执行之后都必须处于一致性状态。让数据保持一定上的合理一个商品出库时,仓库商品数量减1,对应用户的购物车中商品加1</td></tr> <tr><td>隔离性(Isolation)</td> <td>隔离性是当多个用户并发访问效据库时,比如操作同一张表时,数据库为每一个用户开启的事务,不能被其他事务的操作所干扰,多个并发事务之间要相互隔离。</td></tr> <tr><td>持久性(Durability)</td> <td>持久性是指一个事第一旦被提交了,就不能再回滚了,已经把数据保存到数据库当中了。</td></tr></tbody></table> <ul><li>并发事务处理带来的问题</li></ul> <table><thead><tr><th>问题</th> <th></th></tr></thead> <tbody><tr><td>更新丢失</td> <td>两个或多个事务选择同一行,然后基于最初选定的值更新该行时,由于每个事务都不知道其它事务的存在,就会发生丢失更新问题,最后的更新覆盖了其它事务所做的更新</td></tr> <tr><td>脏读</td> <td>老板要给程序员发工资,程序员的工资是3.6万/月。  <br>但是发工资时老板不小心按错了数字，按成3.9万/月，该钱已经打到程序员的户口，但是事务还没有提交，  <br>就在这时，程序员去查看自己这个月的工资，发现比往常多了3千元，以为涨工资了非常高兴。  <br>但是老板及时发现了不对，马上回滚差点就提交了的事务，将数字改成3.6万再提交  <br>实际程序员这个月的工资还是3.6万,但是程序员看到的是3.9万。他看到的是老板还没提交事务时的数据。这就是脏读。  <br>事务A读到了事务B已修改,但尚未提交的数据  <br>解决方法(Read committed! 读提交，能解决脏读问题)</td></tr> <tr><td>不可重复读</td> <td>程序员拿着工资(卡里当然是只有3.6万) ,当他买单时(程序员事务开启) ,收费系统事先检测到他的卡里有3.6万,  <br>就在这个时候! !程序员的妻子要把线全部转出充当家用,并提交。  <br>当收费系统准备扣款时,再检测卡里的金额,发现已经没钱了。程序员就会很郁闷,明明卡里是有钱的...  <br>一个事务范围内两个相同的查询却返回了不同数据,这就是不可重复读  <br>事务A读取到了事务B已经提交的修改数据  <br>解决办法(Repeatable read)</td></tr> <tr><td>重复读</td> <td>程序员拿着工资卡(卡里还是有3.6万) ,当他买时(事务开启,不允许其他事务的UPDATE修改操作) ,收费系统事先检测到他的卡里有3.6万。  <br>这个时候他的妻子不能转出金额了,接下来收费系统就可以扣款了。</td></tr> <tr><td>幻读</td> <td>程序员某一天去消费,花了2千元,然后他的妻子去查看他今天的消费记录(妻子事务开启)  <br>看到确实是花了2千元,就在这个时候,程序员花了1万买了一部电脑,即新增INSERT了一条消费记录,并提交。<br>当妻子打印程序员的消费记录清单时(妻子事务提交) ,发现花了1.2万元,似乎出现了幻觉,这就是幻读。<br>解决办法(Serializple,但是这种事务隔离级别效率低下,比较耗数据库性能,一般不使用。)</td></tr></tbody></table> <p>对应关系:</p> <table><thead><tr><th>事务隔离级别</th> <th>脏读</th> <th>不可重复读</th> <th>幻读</th></tr></thead> <tbody><tr><td>读未提交(read-uncommitted)</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td>不可重复读(read-committed)</td> <td>否</td> <td>是</td> <td>是</td></tr> <tr><td>可重复读(repeatable-read)</td> <td>否</td> <td>否</td> <td>是</td></tr> <tr><td>串行化(serializable)</td> <td>否</td> <td>否</td> <td>否</td></tr></tbody></table> <ul><li>事务隔离级别<br>
Read uncommitted: 就是一个事务可以读取另一个未提交事务的数据<br>
Read committed: 一个事务要等待另一个事务提交后才能读取数据<br>
Repeatable read: 就是在开始读取数据（事务开启）时，不再允许修改操作<br>
Serializable: 在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读和幻读</li> <li>查看隔离级别</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@global.tx_isolation</span><span class="token punctuation">,</span>@<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>设置隔离级别<br>
全局的：<code>set global transaction isolation level read committed;</code><br>
当前会话：<code>set session transaction isolation level read committed;</code></li></ul> <h4 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h4> <h5 id="演示行锁"><a href="#演示行锁" class="header-anchor">#</a> 演示行锁</h5> <ul><li><p>5.5以后，默认后，事务会自动提交</p></li> <li><p>由于演示，开两个连接 都关闭自动提交<code>set autocommit = 0</code></p></li> <li><p>做以下操作：</p></li></ul> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td>执行更新操作</td> <td>自己可以查看到更新的内容，连接2看不到更新的内容,只有commit后,才能看到更新的内容</td></tr> <tr><td>连接1执行更新操作,连接2也执行更新操作,更新同一条记录</td> <td>连接1没有提交事务时,连接2更新处于阻塞状态,当commit时,连接2才会继续执行，连接2更新也要commit</td></tr> <tr><td>连接1和连接2同时更新数据,但更新的不是同一条记录</td> <td>不会影响</td></tr></tbody></table> <p><img src="/assets/img/29.0e72acab.jpg" alt=""> <img src="/assets/img/30.8545dda8.jpg" alt=""> <img src="/assets/img/31.640f33a6.jpg" alt=""> <img src="/assets/img/32.686b3389.jpg" alt=""> <img src="/assets/img/33.6eeb3137.jpg" alt=""> <img src="/assets/img/34.c872b99a.jpg" alt=""> <img src="/assets/img/35.66799f31.jpg" alt=""> <img src="/assets/img/36.6f84a59a.jpg" alt=""> <img src="/assets/img/37.3ef815bf.jpg" alt=""> <img src="/assets/img/38.27defeaf.jpg" alt=""> <img src="/assets/img/39.f5c3eb50.jpg" alt=""> <img src="/assets/img/40.2bad99c6.jpg" alt=""> <img src="/assets/img/41.540c7ffb.jpg" alt=""> <img src="/assets/img/42.3adb0b25.jpg" alt=""> <img src="/assets/img/43.e36bbec8.jpg" alt=""></p> <h4 id="索引失效-行锁变表锁"><a href="#索引失效-行锁变表锁" class="header-anchor">#</a> 索引失效,行锁变表锁</h4> <p><img src="/assets/img/45.c53cabda.jpg" alt=""> <img src="/assets/img/46.02fd6dd2.jpg" alt=""> <img src="/assets/img/47.74d182a2.jpg" alt=""> <img src="/assets/img/48.bae0b6ff.jpg" alt=""> <img src="/assets/img/49.d45bba1e.jpg" alt=""> <img src="/assets/img/50.0215167f.jpg" alt=""> <img src="/assets/img/51.70506372.jpg" alt=""> <img src="/assets/img/52.eab8f874.jpg" alt=""> <img src="/assets/img/53.848d0d1f.jpg" alt=""> <img src="/assets/img/54.156dd97a.jpg" alt=""> <img src="/assets/img/55.48762b82.jpg" alt=""> <img src="/assets/img/56.af8d7d53.jpg" alt=""></p> <h4 id="间隙锁"><a href="#间隙锁" class="header-anchor">#</a> 间隙锁</h4> <p><img src="/assets/img/57.d2369868.jpg" alt=""> <img src="/assets/img/58.e99e0b30.jpg" alt=""> <img src="/assets/img/59.81fb6326.jpg" alt=""> <img src="/assets/img/60.c9ff8bd3.jpg" alt=""> <img src="/assets/img/61.5b627e2b.jpg" alt=""></p> <h4 id="如何锁定一行数据"><a href="#如何锁定一行数据" class="header-anchor">#</a> 如何锁定一行数据</h4> <p><img src="/assets/img/62.2da565eb.jpg" alt=""> <img src="/assets/img/63.b4503972.jpg" alt=""> <img src="/assets/img/64.c114c963.jpg" alt=""> <img src="/assets/img/65.57e0ac5a.jpg" alt=""> <img src="/assets/img/66.2a986bbb.jpg" alt=""> <img src="/assets/img/67.f6def8b2.jpg" alt=""> <img src="/assets/img/68.3a3d6deb.jpg" alt=""></p> <h4 id="show-status-like-innodb-row-lock"><a href="#show-status-like-innodb-row-lock" class="header-anchor">#</a> show status like 'innodb_row_lock%';</h4> <p><img src="/assets/img/69.cc1c0550.jpg" alt=""></p> <h3 id="悲观锁"><a href="#悲观锁" class="header-anchor">#</a> 悲观锁</h3> <ul><li>就是很悲观，它对于数据被外界修改保持保守态度，认为数据随时会修改，</li> <li>所以整个数据处理中需要将数据加锁。悲观锁一般都是依靠关系数据库提供的锁机制，</li> <li>事实上关系数据库中的行锁，表锁不论是读写锁都是悲观锁</li></ul> <h3 id="乐观锁"><a href="#乐观锁" class="header-anchor">#</a> 乐观锁</h3> <ul><li><p>顾名思义，就是很乐观，每次自己操作数据的时候认为没有人会来修改它，所以不去加锁</p></li> <li><p>但是在更新的时候会去判断在此期间数据有没有被修改，需要用户自己去实现</p></li> <li><p>不会发生并发抢占资源，只有在提交操作的时候检查是否违反数据完整性</p></li> <li><p>为什么要使用乐观锁?
对于读操作远多于写操作的时候，大多数都是读取，这时候一个更新操作加锁会阻塞所有读取，降低了吞吐量。<br>
最后还要释放锁，锁是需要一些开销的，我们只要想办法解决极少量的更新操作的同步问题。<br>
换句话说，如果是读写比例差距不是非常大或者你的系统没有响应不及时，吞吐量瓶颈问题，那就不要去使用乐观锁，它增加了复杂度，也带来了额外的风险。</p></li> <li><p>乐观锁的实现方式
版本号:<br> <img src="/assets/img/70.703e02f0.jpg" alt=""> <img src="/assets/img/71.12c64219.jpg" alt=""> <img src="/assets/img/72.9a98b389.jpg" alt=""> <img src="/assets/img/73.041e718e.jpg" alt="">
时间戳:</p></li></ul> <h2 id="linux环境下操作mysql"><a href="#linux环境下操作mysql" class="header-anchor">#</a> Linux环境下操作Mysql</h2> <h2 id="主从复制"><a href="#主从复制" class="header-anchor">#</a> 主从复制</h2> <h2 id="日志分析"><a href="#日志分析" class="header-anchor">#</a> 日志分析</h2></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/document/database/mysql-Master-slave-replication-read-write-separation.html" class="prev">
          MySQL-主从复制与读写分离
        </a></span> <span class="next"><a href="/blog/document/database/mysql-uninstall.html">
          MySQL-卸载
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#mysql进阶" class="sidebar-link reco-side-mysql进阶" data-v-b57cc07c>Mysql进阶</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#索引与表设计准则" class="sidebar-link reco-side-索引与表设计准则" data-v-b57cc07c>索引与表设计准则</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#explain执行计划" class="sidebar-link reco-side-explain执行计划" data-v-b57cc07c>Explain执行计划</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#sql优化" class="sidebar-link reco-side-sql优化" data-v-b57cc07c>SQL优化</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#mysql中锁机制" class="sidebar-link reco-side-mysql中锁机制" data-v-b57cc07c>Mysql中锁机制</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#概念" class="sidebar-link reco-side-概念" data-v-b57cc07c>概念</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#举例" class="sidebar-link reco-side-举例" data-v-b57cc07c>举例</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#锁分类" class="sidebar-link reco-side-锁分类" data-v-b57cc07c>锁分类</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#表锁" class="sidebar-link reco-side-表锁" data-v-b57cc07c>表锁</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#行锁" class="sidebar-link reco-side-行锁" data-v-b57cc07c>行锁</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#悲观锁" class="sidebar-link reco-side-悲观锁" data-v-b57cc07c>悲观锁</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#乐观锁" class="sidebar-link reco-side-乐观锁" data-v-b57cc07c>乐观锁</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#linux环境下操作mysql" class="sidebar-link reco-side-linux环境下操作mysql" data-v-b57cc07c>Linux环境下操作Mysql</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#主从复制" class="sidebar-link reco-side-主从复制" data-v-b57cc07c>主从复制</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/document/database/mysql-performance-optimization.html#日志分析" class="sidebar-link reco-side-日志分析" data-v-b57cc07c>日志分析</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.99990956.js" defer></script><script src="/assets/js/15.0cf965fc.js" defer></script><script src="/assets/js/1.f6a8d0e9.js" defer></script><script src="/assets/js/8.f65b31ef.js" defer></script>
  </body>
</html>
